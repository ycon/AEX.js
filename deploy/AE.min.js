/*

 Released under the MIT license
 Author: Yannick Connan
 Version: 0.1.1 - Build: 18028 (2012/04/30 12:12 AM)
*/
(function(T){var p={VERSION:"0.1.1"};(function(a){function b(a,b,c,d,g){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=g||0}function c(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}var d={VERSION:"0.7.1"};b.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());
return b},detach:function(){return this.isBound()?this._signal.remove(this._listener):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};d.Signal=function(){this._bindings=[];this._prevParams=null};
d.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,c,d,i){var g=this._indexOfListener(a);if(-1!==g){if(a=this._bindings[g],a.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(!c?"":"Once")+"() the same listener without removing the relationship first.");}else a=new b(this,a,c,d,i),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&
a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a){for(var b=this._bindings.length;b--;)if(this._bindings[b]._listener===a)return b;return-1},has:function(a){return-1!==this._indexOfListener(a)},add:function(a,b,d){c(a,"add");return this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){c(a,"addOnce");return this._registerListener(a,!0,b,d)},remove:function(a){c(a,"remove");var b=this._indexOfListener(a);-1!==b&&(this._bindings[b]._destroy(),
this._bindings.splice(b,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;if(this.memorize)this._prevParams=b;if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},
forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};"function"===typeof define&&define.amd?define("signals",[],d):"undefined"!==typeof module&&module.exports?module.exports=d:a.signals=d})(this);var M=this.signals;if(!Function.prototype.bind)Function.prototype.bind=function(a){var b=this;if("function"!==typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+
b);var c=slice.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var e=new e,f=b.apply(e,c.concat(slice.call(arguments)));return Object(f)===f?f:e}return b.apply(a,c.concat(slice.call(arguments)))};return d};if(!Array.isArray)Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){var b,c;"a"!="a"[0]&&"string"==typeof o&&o&&(b=this.split(""));b=Object(this);c=
b.length>>>0;if(!c)return-1;var d=0;1<arguments.length&&(d=toInteger(arguments[1]));for(d=0<=d?d:Math.max(0,c+d);d<c;d++)if(d in b&&b[d]===a)return d;return-1};var E=function(a){return a.charAt(0).toUpperCase()+a.substr(1)},P=function(a){for(var b=[a],c=0,d=H.length,a=E(a);c<d;c+=1)b.push(H[c]+a);return b},H="Webkit Moz O ms Khtml".split(" "),m={TRANSFORM:"Transform",TRANSFORM_STYLE:"transformStyle",PERSPECTIVE:"perspective",ORIGIN:"perspectiveOrigin",getLocalBound:function(a){for(var b=0,c=0,d=0,
e=0,a=a.childNodes,f=a.length,h=0,i=Math.min,g=Math.max,k=1,j,w,l,m;h<f;h+=1)if(j=a[0],1===j.nodeType&&j.childNodes.length){k=parseFloat(j.style.zoom)||1;j=j.childNodes;l=j.length;for(m=0;m<l;m+=1)w=j[m],b=i(w.offsetLeft*k,b),d=i(w.offsetTop*k,d),c=g((w.offsetWidth+w.offsetLeft)*k,c),e=g((w.offsetHeight+w.offsetTop)*k,e)}else b=i(j.offsetLeft,b),d=i(j.offsetTop,d),c=g(j.offsetWidth+j.offsetLeft,c),e=g(j.offsetHeight+j.offsetTop,e);return{x:b,y:d,width:c-b,height:e-d}}};m.haveTransform=function(){var a=
document.createElement("div"),b=P(this.TRANSFORM),c=0,d=b.length;if(a)for(;c<d;c+=1)if(c&&void 0!==a.style[b[c]])return this.TRANSFORM=H[c-1]+E(this.TRANSFORM),!0;return!1}.call(m);m.have3DTransform=function(){var a=document.createElement("div"),b=P(this.PERSPECTIVE),c=0,d=b.length;if(a)for(;c<d;c+=1)if(c&&void 0!==a.style[b[c]])return a=H[c-1],this.PERSPECTIVE=a+E(this.PERSPECTIVE),this.ORIGIN=a+E(this.ORIGIN),this.TRANSFORM_STYLE=a+E(this.TRANSFORM_STYLE),!0;return!1}.call(m);m.haveIEFilter=function(){var a=
document.createElement("div");return a&&void 0!==a.style.filter?(a.style.width=a.style.height="100px",a.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand')",void 0!==a.onfilterchange):!1}.call(m);p.Browser=m;var I=function(a,b,c,d){var e=0.5*(b-a),a=0.5*(a+b),b=d.clone();sum=0.3478548451*b.multiplyScalar(2*(a+-0.8611363116*e)).add(c).lengthSq();sum+=0.3478548451*b.copy(d).multiplyScalar(2*(a+0.8611363116*e)).add(c).lengthSq();sum+=0.6521451549*b.copy(d).multiplyScalar(2*
(a+-0.3399810436*e)).add(c).lengthSq();return sum+=0.6521451549*b.copy(d).multiplyScalar(2*(a+0.3399810436*e)).add(c).lengthSq()},Q=function(a,b,c,d,e,f){var h=a.clone(),i=d.clone();if(c.equals(d))return e.curveTo(h.lerp(b,0.89),d),e;if(b.equals(a))return e.curveTo(i.lerp(c,0.89),d),e;h.lerp(b,1.5);i.lerp(c,1.5);f||(f=(Math.max(Math.max(h.max(),i.max()),Math.max(a.max(),d.max()))-Math.min(Math.min(h.min(),i.min()),Math.min(a.min(),d.min())))/350);var g=Math.sqrt(10.3923048/h.distance(i)*f);if(1<g)e.curveTo(h.lerp(i,
0.5),d);else{var a=a.clone(),k=a.clone().lerp(b,g),j=c.clone().lerp(d,g),w=b.clone().lerp(c,g),m=k.clone().lerp(w,g),b=w.lerp(j,g),l=m.clone().lerp(b,g),h=a.clone().lerp(k,1.5);i.copy(l).lerp(m,1.5);e.curveTo(h.lerp(i,0.5),l.clone());0.5>g&&(g=1-g/(1-g),b=b.clone(),c=j.clone(),a.copy(l),k.copy(a).lerp(b,g),j.copy(c).lerp(d,g),w.copy(b).lerp(c,g),m.copy(k).lerp(w,g),b=w.lerp(j,g),l.copy(m).lerp(b,g),Q(a,k,m.clone(),l.clone(),e,f));h=l.clone().lerp(b,1.5);i=d.clone().lerp(j,1.5);e.curveTo(h.lerp(i,
0.5),d.clone())}return e},R=function(a){if(!(a instanceof this.type_))throw"not the right type";},t=function(a){this.items_=[];this.type_=Object;if(a&&a.prototype instanceof this.type_)this.type_=a;this.on={add:new M.Signal,remove:new M.Signal,swap:new M.Signal}};t.prototype={constructor:t,items_:null,type_:null,index:function(a){return this.items_.indexOf(a)},have:function(a){return-1!==this.index(a)},get:function(a){return this.items_[a]},getLength:function(){return this.items_.length},add:function(a){R.call(this,
a);if(this.have(a))throw"item already present";this.items_.push(a);this.on.add.dispatch(a,this.length-1,this)},insert:function(a,b){R.call(this,a);var c=this.items_;if(this.have(a))throw"item already present";b<c.length?c.splice(b,0,a):c.push(a);c=Math.max(b,this.length-1);this.on.add.dispatch(a,c,this)},remove:function(a){var b=this.items_,c=b.indexOf(a);if(-1!==c)b.splice(c,1),this.on.remove.dispatch(a,c,this);else throw"item not present";},swap:function(a,b){var c=this.items_,d=c.indexOf(a),e=
c.indexOf(b);if(-1!==d&&-1!==e)c[d]=b,c[e]=a,this.on.swap.dispatch(d,e,this);else throw"one of the items not present";},each:function(a){for(var b=this.items_,c=b.length,d=0;d<c;d++)a(b[d])}};p.Stack=t;var U={ease:function(a,b,c,d,e,f){b=b||0;d=d||0;a=this.solveCurveX(a||0,c||0,e||0,f);c=3*b;b=3*(d-b)-c;return(((1-c-b)*a+b)*a+c)*a},solveCurveX:function(a,b,c,d){var e=this.fabs,f=3*a,a=3*(b-a)-f,b=1-f-a,h=2*a,i=3*b,g,k,j,l;d||(d=1.0E-4);g=c;l=0;a:for(;8>l;l++){k=((b*g+a)*g+f)*g-c;if(e(k)<d)return g;
j=(i*g+h)*g+f;if(1.0E-6>e(j))break a;g-=k/j}h=0;i=1;g=c;if(g<h)return h;if(g>i)return i;for(l=0;h<i&&10>l;){k=((b*g+a)*g+f)*g;if(e(k-c)<d)break;c>k?h=g:i=g;g=0.5*(i-h)+h;l++}return g},fabs:function(a){return 0<=a?a:0-a}},l=function(a,b,c){this.x=a||0;this.y=b||0;this.z=c||0};l.isVector=function(a){return a&&"number"===typeof a.x&&"number"===typeof a.y};l.prototype={constructor:l,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=
a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z||0;return this},clone:function(){return new l(this.x,this.y,this.z)},add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=a;this.y+=a;this.z+=a;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},
divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},
cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},flatten:function(a,b){var c=a/(a-this.z);this.x=this.x*c+b.x*(1-c);this.y=this.y*c+b.y*(1-c);return this},multiplyMatrix:function(a){a.multiplyVector(this);return this},distance:function(a){return Math.sqrt(this.distanceSq(a))},distanceSq:function(a){return this.clone().sub(a).lengthSq()},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},isZero:function(){return 1.0E-4>
this.lengthSq()},max:function(){return Math.max(this.x,Math.max(this.y,this.z))},min:function(){return Math.min(this.x,Math.min(this.y,this.z))},setFromQuaternion:function(a){this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),a.w*a.w-a.x*a.x-a.y*a.y+a.z*a.z);this.y=Math.asin(2*(a.x*a.z+a.y*a.w));this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),a.w*a.w+a.x*a.x-a.y*a.y-a.z*a.z)}};p.Vector=l;var n=function(){arguments.length&&this.injectArray(arguments)};n.tMat_=new n;n.tVec1_=new l;n.tVec2_=new l;n.tVec3_=new l;n.prototype=
{constructor:n,m11:1,m12:0,m13:0,m14:0,m21:0,m22:1,m23:0,m24:0,m31:0,m32:0,m33:1,m34:0,m41:0,m42:0,m43:0,m44:1,set:function(a,b,c,d,e,f,h,i,g,k,j,l,m,n,p,q){this.m11=a;this.m12=b;this.m13=c;this.m14=d;this.m21=e;this.m22=f;this.m23=h;this.m24=i;this.m31=g;this.m32=k;this.m33=j;this.m34=l;this.m41=m;this.m42=n;this.m43=p;this.m44=q;return this},injectArray:function(a){return this.set.apply(this,a)},injectMatrix:function(a){this.m11=a.m11;this.m12=a.m12;this.m13=a.m13;this.m14=a.m14;this.m21=a.m21;
this.m22=a.m22;this.m23=a.m23;this.m24=a.m24;this.m31=a.m31;this.m32=a.m32;this.m33=a.m33;this.m34=a.m34;this.m41=a.m41;this.m42=a.m42;this.m43=a.m43;this.m44=a.m44;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},translation:function(a,b,c){this.set(1,0,0,0,0,1,0,0,0,0,1,0,a||0,b||0,c||0,1);return this},translate:function(a,b,c){this.m41+=a||0;this.m42+=b||0;this.m43+=c||0;return this},scaling:function(a,b,c){this.set(a||0,0,0,0,0,b||0,0,0,0,0,c||0,0,0,0,0,
1);return this},scale:function(a,b,c){a=a||1.0E-6;b=b||1.0E-6;c=c||1.0E-6;if(1!==a||1!==b||1!==c)this.m11*=a,this.m21*=a,this.m31*=a,this.m41*=a,this.m12*=b,this.m22*=b,this.m32*=b,this.m42*=b,this.m13*=c,this.m23*=c,this.m33*=c,this.m43*=c;return this},rotation:function(a,b,c){this.identity();var d=Math.PI/180,a=(a||0)*d,b=(b||0)*d,c=(-c||0)*d,e=Math.cos,f=Math.sin,d=e(a),a=f(a),h=e(b),b=f(b),e=e(c),c=f(c),f=d*e,i=d*c,g=a*e,k=a*c;this.m11=h*e;this.m12=g*b-i;this.m13=f*b+k;this.m21=h*c;this.m22=k*
b+f;this.m23=i*b-g;this.m31=-b;this.m32=a*h;this.m33=d*h;this.m41=this.m42=this.m43=0;return this},rotate:function(a,b,c){if(!this.temp_)this.temp_=new n;return a||b||c?this.multiply(this.temp_.rotation(a,b,c)):this},quaternionRotation:function(a,b,c,d){var e=d*d,f=a*a,h=b*b,i=c*c,g=1/(f+h+i+e);this.m11=(f-h-i+e)*g;this.m22=(-f+h-i+e)*g;this.m33=(-f-h+i+e)*g;e=a*b;f=c*d;this.m21=2*(e+f)*g;this.m12=2*(e-f)*g;e=a*c;f=b*d;this.m31=2*(e-f)*g;this.m13=2*(e+f)*g;e=b*c;f=a*d;this.m32=2*(e+f)*g;this.m23=
2*(e-f)*g;return this},quaternionRotate:function(a,b,c,d){if(!this.temp_)this.temp_=new n;return this.multiply(this.temp_.quaternionRotation(a,b,c,!d&&0!==d?1:d))},lookingAt:function(a,b,c){var d=n.tVec1_.set(0,1,0),e=n.tVec2_,a=n.tVec3_.set(-a,-b,c).normalize();d.cross(a);e.copy(a).cross(d);d.normalize();e.normalize();this.set(d.x,d.y,d.z,0,e.x,e.y,e.z,0,a.x,a.y,a.z,0,0,0,0,1);return this},lookAt:function(a,b,c){if(!this.temp_)this.temp_=new n;return a||b?this.multiply(this.temp_.lookingAt(a,b,c)):
this},determinant:function(){return-this.m13*this.m22*this.m31+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m11*this.m23*this.m32-this.m12*this.m21*this.m33+this.m11*this.m22*this.m33},invert:function(){var a=this.m11,b=this.m12,c=this.m13,d=this.m21,e=this.m22,f=this.m23,h=this.m31,i=this.m32,g=this.m33,k=this.m41,j=this.m42,l=this.m43,m=1/this.determinant();this.m11=(-f*i+e*g)*m;this.m12=(c*i-b*g)*m;this.m13=(-c*e+b*f)*m;this.m14=0;this.m21=(f*h-d*g)*m;this.m22=(-c*h+a*g)*m;this.m23=
(c*d-a*f)*m;this.m24=0;this.m31=(-e*h+d*i)*m;this.m32=(b*h-a*i)*m;this.m33=(-b*d+a*e)*m;this.m34=0;this.m41=(f*i*k-e*g*k-f*h*j+d*g*j+e*h*l-d*i*l)*m;this.m42=(b*g*k-c*i*k+c*h*j-a*g*j-b*h*l+a*i*l)*m;this.m43=(c*e*k-b*f*k-c*d*j+a*f*j+b*d*l-a*e*l)*m;this.m44=1;return this},createInvert:function(){return this.clone().invert()},clone:function(){return(new n).set(this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44)},
join:function(a,b){var c=a.m11,d=a.m12,e=a.m13,f=a.m14,h=a.m21,i=a.m22,g=a.m23,k=a.m24,j=a.m31,l=a.m32,m=a.m33,n=a.m34,p=a.m41,q=a.m42,r=a.m43,s=a.m44,t=b.m11,u=b.m12,v=b.m13,x=b.m14,y=b.m21,z=b.m22,A=b.m23,B=b.m24,C=b.m31,D=b.m32,E=b.m33,F=b.m34,G=b.m41,H=b.m42,I=b.m43,J=b.m44;this.m11=c*t+d*y+e*C+f*G;this.m12=c*u+d*z+e*D+f*H;this.m13=c*v+d*A+e*E+f*I;this.m14=c*x+d*B+e*F+f*J;this.m21=h*t+i*y+g*C+k*G;this.m22=h*u+i*z+g*D+k*H;this.m23=h*v+i*A+g*E+k*I;this.m24=h*x+i*B+g*F+k*J;this.m31=j*t+l*y+m*C+n*
G;this.m32=j*u+l*z+m*D+n*H;this.m33=j*v+l*A+m*E+n*I;this.m34=j*x+l*B+m*F+n*J;this.m41=p*t+q*y+r*C+s*G;this.m42=p*u+q*z+r*D+s*H;this.m43=p*v+q*A+r*E+s*I;this.m44=p*x+q*B+r*F+s*J;return this},multiply:function(a){return this.join(this,a)},preMultiply:function(a){return this.join(a,this)},multiplyVector:function(a){var b=a.x;vy=a.y;vz=a.z;a.x=this.m11*b+this.m21*vy+this.m31*vz+this.m41;a.y=this.m12*b+this.m22*vy+this.m32*vz+this.m42;a.z=this.m13*b+this.m23*vy+this.m33*vz+this.m43;return a},toCSS:function(){return"matrix3d("+
this.m11.toFixed(4)+","+this.m12.toFixed(4)+","+this.m13.toFixed(4)+","+this.m14.toFixed(4)+","+this.m21.toFixed(4)+","+this.m22.toFixed(4)+","+this.m23.toFixed(4)+","+this.m24.toFixed(4)+","+this.m31.toFixed(4)+","+this.m32.toFixed(4)+","+this.m33.toFixed(4)+","+this.m34.toFixed(4)+","+this.m41.toFixed(4)+","+this.m42.toFixed(4)+","+this.m43.toFixed(4)+","+this.m44.toFixed(4)+")"},toArray:function(){return[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,
this.m33,this.m34,this.m41,this.m42,this.m43,this.m44]}};p.Matrix=n;var q=function(){arguments.length&&this.injectArray(arguments)};q.matrix_=new q;q.v1_=new l;q.v2_=new l;q.v3_=new l;q.prototype={constructor:q,m11:1,m12:0,m21:0,m22:1,x:0,y:0,z:0,set:function(a,b,c,d,e,f,h){this.m11=a;this.m12=b;this.m21=c;this.m22=d;this.x=e;this.y=f;this.z=h;return this},injectArray:function(a){return this.set.apply(this,a)},injectMatrix:function(a){this.m11=a.m11;this.m12=a.m12;this.m21=a.m21;this.m22=a.m22;this.x=
a.x;this.y=a.y;this.z=a.z;return this},identity:function(){this.set(1,0,0,1,0,0,0);return this},translation:function(a,b,c){this.set(1,0,0,1,a||0,b||0,c||0,1);return this},translate:function(a,b,c){this.x+=a||0;this.y+=b||0;this.z+=c||0;return this},preTranslate:function(a,b,c){this.x+=a*this.m11+b*this.m21;this.y+=a*this.m12+b*this.m22;this.z+=c||0;return this},scaling:function(a,b){this.set(a||0,0,b||0,0,0,0);return this},scale:function(a,b){a=a||1.0E-6;b=b||1.0E-6;if(1!==a||1!==b)this.m11*=a,this.m12*=
a,this.x*=a,this.m21*=b,this.m22*=b,this.y*=b;return this},rotation:function(){return this},rotate:function(a){return a?this.multiply(q.matrix_.rotation(a)):this},clone:function(){return(new q).set(this.m11,this.m12,this.m21,this.m22,this.x,this.y,this.z)},join:function(a,b){var c=a.m11,d=a.m12,e=a.m21,f=a.m22,h=a.x,i=a.y,g=b.m11,k=b.m12,j=b.m21,l=b.m22,m=b.x,n=b.y;this.m11=c*g+d*j;this.m12=c*k+d*l;this.m21=e*g+f*j;this.m22=e*k+f*l;this.x=h*g+i*j+m;this.y=h*k+i*l+n;return this},multiply:function(a){return this.join(this,
a)},preMultiply:function(a){return this.join(a,this)},multiplyVector:function(a){var b=a.x;vy=a.y;a.x=this.m11*b+this.m21*vy+this.x;a.y=this.m12*b+this.m22*vy+this.y;return a},copy3D:function(a){this.m11=a.m11;this.m12=a.m12;this.m21=a.m21;this.m22=a.m22;this.x=a.m41;this.y=a.m42;return this},simulate3D:function(a,b,c,d){var e=q.v1_.copy(c).multiplyMatrix(a).flatten(d,b),a=q.v2_.set(c.x+1,c.y,0).multiplyMatrix(a).flatten(d,b).sub(e),b=q.v3_.set(c.x,c.y+1,0).flatten(d,b).sub(e);this.m11=a.x;this.m12=
a.y;this.m21=b.x;this.m22=b.y;this.x=e.x-(c.x*this.m11+c.y*this.m21);this.y=e.y-(c.x*this.m12+c.y*this.m22);return this},toCSS:function(){return"matrix("+this.m11.toFixed(4)+","+this.m12.toFixed(4)+","+this.m21.toFixed(4)+","+this.m22.toFixed(4)+","+this.x.toFixed(4)+","+this.y.toFixed(4)+")"},toArray:function(){return[this.m11,this.m12,this.m21,this.m22,this.x,this.y]}};p.Matrix2D=q;var u=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d||1};u.isQuaternion=function(a){return a&&"number"===
typeof a.x&&"number"===typeof a.y&&"number"===typeof a.w};u.prototype={constructor:u,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c||0;this.w=!d&&0!==d?1:d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z||0;this.w=a.w||1;return this},clone:function(){return new u(this.x,this.y,this.z,this.w)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},multiply:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;this.w=e*a.w-b*a.x-c*a.y-d*a.z;this.x=e*a.x+b*a.w+
c*a.z-d*a.y;this.y=e*a.y+c*a.w+d*a.x-b*a.z;this.z=e*a.z+d*a.w+b*a.y-c*a.x;return this},setFromEuler:function(a){var b=Math.sin,c=Math.cos,d=Math.PI/360,e=a.x*d,f=a.y*d,h=a.z*d,a=c(f),f=b(f),d=c(-h),h=b(-h),c=c(e),b=b(e);if(!this.temp_)this.temp_=new u;this.set(0,0,h,d).multiply(this.temp_.set(0,f,0,a)).multiply(this.temp_.set(b,0,0,c));return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):this.w=this.z=this.y=this.x=0;return this},lengthSq:function(){return this.x*this.x+
this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lerp:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.w,h=f*a.w+c*a.x+d*a.y+e*a.z,i,g;0>h?(this.set(-a.x,-a.y,-a.z,-a.w),h=-h):this.copy(a);i=Math.acos(h);g=Math.sqrt(1-h*h);if(0.0010>Math.abs(g))return this.set(0.5*(c+a.x),0.5*(d+a.y),0.5*(e+a.z),0.5*(f+a.w)),this;h=Math.sin((1-b)*i)/g;i=Math.sin(b*i)/g;this.set(c*h+this.x*i,d*h+this.y*i,
e*h+this.z*i,f*h+this.w*i);return this},toJSON:function(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};p.Quaternion=u;var J=function(a,b){this.start=a;this.end=b;this.update=!0};J.prototype={constructor:J,length:function(){if(this.update)this.length_=this.start.distance(this.end),this.update=!1;return this.length_},getVect:function(a,b){return(b?b.copy(this.start):this.start.clone()).lerp(this.end,a)}};p.Line=J;var K=function(a,b,c){this.start=a;this.anchor=b;this.end=c;this.temp_=this.start.clone();
this.update=!0};K.prototype={constructor:K,length:function(){if(this.update){this.update=!1;var a=this.anchor.clone().sub(this.start).multiplyScalar(2),b=this.start.clone().sub(this.anchor.clone().multiplyScalar(2)).add(this.end),c=Math.sqrt,d,e,f;d=c(I(0,0.25,a,b))/5.65685425;e=c(I(0.25,0.5,a,b))/5.65685425;f=c(I(0.5,0.75,a,b))/5.65685425;a=d+e+f+c(I(0.75,1,a,b))/5.65685425;f=(d+e+f)/a;e=(d+e)/a;d/=a;this.length_=a;this.inverse_=[d,e,f,0.5+(1-d/(e-d))/4,0.5-(1-(1-f)/(f-e))/5]}return this.length_},
getVect:function(a,b){this.length();var c,d=this.inverse_,e=d[0],f=d[1],h=d[2];c=d[3];d=d[4];a>=h?(e=(a-h)/(1-h),c=d,f=0.75):a>=f?(e=(a-f)/(h-f),f=0.5,c=d):a>=e?(e=(a-e)/(f-e),f=0.25):(e=a/e,f=0);c=0.25*(2*(1-e)*e*c+e*e)+f;return(b?b.copy(this.start):this.start.clone()).lerp(this.anchor,c).lerp(this.temp_.copy(this.anchor).lerp(this.end,c),c)}};p.QuadCurve=K;var L=function(a){this.start=a||0;this.elements=[];this.update=!0};L.prototype={constructor:L,length:function(){if(this.update){var a=0,b=this.elements.length,
c;this.update=!1;this.lengths_=[a];for(c=0;c<b;c++)a+=this.elements[c].length(),this.lengths_.push(a);this.lastItemPos_=this.lastPos_=0;this.length_=a}return this.length_},getItem:function(a){for(var a=a*this.length(),b=a>=this.lastPos_?1:-1,c=this.elements.length,d,e,f=this.lastItemPos_;f<c;f+=b)if(d=this.lengths_[f],e=this.elements[f],a>=d&&a<d+e.length())return this.lastItemPos_=f,this.lastPos_=d,e},getVect:function(a,b){var c=this.getItem(a),a=a*this.length();return c?c.getVect((a-this.lastPos_)/
c.length(),b):b?b.copy(this.start):this.start.clone()},lineTo:function(a){this.elements.push(new J(this.start,a));this.start=a;this.update=!0},curveTo:function(a,b){this.elements.push(new K(this.start,a,b));this.start=b;this.update=!0},cubicCurveTo:function(a,b,c){this.elements.push(new F(this.start,a,b,c));this.start=c;this.update=!0}};p.Path=L;var F=function(a,b,c,d){this.start=a;this.a1=b;this.a2=c;this.end=d;this.update=!0};F.prototype={constructor:F,length:function(){if(this.update)this.update=
!1,this.path=Q(this.start,this.a1,this.a2,this.end,new L(this.start)),this.length_=this.path.length();return this.length_},getVect:function(a,b){this.length();return this.path.getVect(a,b)}};p.CubicCurve=F;var z=function(a,b,c,d){t.call(this);this.layer=a;this.inPoint=b||0;this.outPoint=c||1/0;this.source=d;this.startTime=0;this.speed=1;this.remap=new y};z.prototype=new t;z.prototype.constructor=z;z.prototype.animate=function(a){var b=this.layer,c=this.items_;if(a>=this.inPoint&&a<=this.outPoint){b.visible=
!0;for(var b=c.length,d=0;d<b;d++)c[d].set(a);this.source&&(this.remap.num()?this.source.animate(this.remap.get(a-this.startTime)):this.source.animate((a-this.startTime)*this.speed))}else b.visible=!1};var B=function(a){t.call(this);this.item=a;this.duration=1;this.frameRate=25;this.clamp=!1};B.prototype=new t;B.prototype.constructor=B;B.prototype.animate=function(a){var b=this.items_,c=b.length,a=a%this.duration;this.clamp&&(a=Math.floor(a*this.frameRate)/this.frameRate);if(a!==this.prevTime_){for(var d=
0;d<c;d++)b[d].animate(a);this.prevTime_=a}};var V=function(a,b,c){this.offset=a;this.position_=0;this.value=b;this.isHold=c;this.outY=this.outX=this.inY=this.inX=0;this.path=this.outTangent=this.inTangent=null;this.update=!1},y=function(a,b){this.target=a;this.property=b;this.keys_=[];this.length_=0};y.prototype={constructor:y,length:function(){var a=this.keys_,b,c,d,e;if(this.update){d=a.length;for(c=e=0;c<d;c++)if(b=a[c],e+=b.offset,b.position_=e,b.update&&b.path&&(b.inTangent||b.outTangent))this.path=
null,b.update=!1;this.length_=e;this.update=!1}return this.length_},num:function(){return this.keys_.length},indexAt:function(a){var b=this.keys_,c=this.prevIndex_||0,d=a>=(this.prevPosition_||0)?1:-1;this.length();this.prevPosition_=a;if(a<=b[0].position_)return this.prevIndex_=0;if(a>=b[b.length-1].position_)return this.prevIndex_=b.length-1;for(;b[c];){if(a>=b[c].position_&&(!b[c+1]||a<b[c+1].position_))return this.prevIndex_=c,this.prevPosition_=a,this.prevIndex_;c+=d}return this.prevIndex_=0},
get:function(a,b){var c=this.indexAt(a),d=this.keys_[c],e;if(0===c&&a<=d.offset||c>=this.num()-1||d.isHold)return d.value;c=this.keys_[c+1];e=(a-d.position_)/c.offset;if(d.outX||d.outY||c.inX||c.inY)e=U.ease(d.outX,d.outY,c.inX,c.inY,e);return this.interpolate(d,c,e,b)},interpolate:function(a,b,c){return a.value+(b.value-a.value)*c},set:function(a){a=this.get(a);this.target[this.property]!==a&&(this.target[this.property]=a)},add:function(a,b,c){b=new V(a,b,c);this.length_+=a;b.position_=this.length_;
this.keys_.push(b);return b}};p.Keys=y;var A=function(a,b){y.call(this,a,b);this.temp_=a[b].clone()};A.prototype=new y;A.prototype.constructor=A;A.prototype.interpolate=function(a,b,c,d){if(a.update)a.path=a.outTangent&&b.inTangent?new F(a.value,a.outTangent.clone().add(a.value),b.inTangent.clone().add(b.value),b.value):null,a.update=!1;return a.path?a.path.getVect(c,d):(d?d.copy(a.value):a.value.clone()).lerp(b.value,c)};A.prototype.set=function(a){var a=this.get(a,this._temp),b=this.target[this.property];
b.equals&&!b.equals(a)&&b.copy(a)};p.SpatialKeys=A;var x=function(){this.is3D=!0;this.parent=null;this.visible=!0;this.name=null;this.type="null";this.matrix_=new n;this.matrix2D_=new n};x.prototype.getMatrix=function(){if(!this.is3D)return this.getMatrix2D();var a=this.matrix_.injectMatrix(this.getLocalMatrix()),b=this.parent;b&&b!==this&&a.multiply(b.getMatrix());return a};x.prototype.getMatrix2D=function(){var a=this.matrix2D_.injectMatrix(this.getLocalMatrix2D()),b=this.parent;b&&a.multiply(b.getMatrix2D());
return a};x.prototype.getLocalMatrix=function(){return new n};x.prototype.getLocalMatrix2D=function(){return new n};var r=function(){x.call(this);this.filters=new t;this.masks=new t;this.collapse=!1;this.position=new l;this.anchor=new l;this.scale=new l(1,1,1);this.rotation=new l;this.orientation=new u;this.opacity=1;this.type="null";this.localMatrix_=new n;this.localMatrix2D_=new n;this.depthPoint_=new l};r.prototype=new x;r.prototype.constructor=r;r.prototype.getLocalMatrix=function(){var a=this.position,
b=this.anchor,c=this.scale,d=this.rotation,e=this.orientation;return this.localMatrix_.translation(-b.x,-b.y,b.z).scale(c.x,c.y,c.z).rotate(d.x,d.y,d.z).quaternionRotate(e.x,e.y,e.z,e.w).translate(a.x,a.y,-a.z)};r.prototype.getLocalMatrix2D=function(){var a=this.position,b=this.anchor,c=this.scale;return this.localMatrix2D_.translation(-b.x,-b.y,0).scale(c.x,c.y,1).rotate(0,0,this.rotation.z).translate(a.x,a.y,0)};r.prototype.getDepthPoint=function(){return this.depthPoint_.set(Math.max(Math.min(this.width||
1024,this.anchor.x),0),Math.max(Math.min(this.height||768,this.anchor.y),0),0)};p.Layer=r;var s=function(){x.call(this);this.position=new l;this.rotation=new l;this.orientation=new u;this.target=new l;this.haveTarget=!0;this.zoom=1333.33;this.center=new l;this.is3D=!0;this.type="camera";this.localMatrix_=new n;this.localMatrix2D_=new n;this.matrixCamera_=new n;this.tempMatrixCamera_=new n};s.prototype=new x;s.prototype.constructor=s;s.prototype.getLocalMatrix=function(){var a=this.rotation,b=this.target,
c=this.position,d=this.orientation,a=this.localMatrix_.rotation(a.x,a.y,a.z);a.m41=a.m42=a.m43=0;a.quaternionRotate(d.x,d.y,d.z,d.w);this.haveTarget&&a.lookAt(b.x-c.x,b.y-c.y,b.z-c.z);a.translate(c.x,c.y,-c.z);return a};s.prototype.getLocalMatrix2D=function(){return this.localMatrix2D_.rotation(0,0,this.rotation.z).translate(this.position.x,this.position.y,0)};s.prototype.getCameraMatrix=function(){var a=this.center;return this.matrixCamera_.translation(a.x,a.y,this.zoom).preMultiply(this.tempMatrixCamera_.identity().injectMatrix(this.getMatrix()).invert())};
s.prototype.align=function(a,b){this.center.x=this.position.x=a;this.center.y=this.position.y=b;this.position.z=-this.zoom};p.Camera=s;var G=function(){r.call(this);this.color="#000000";this.width=640;this.height=360;this.type="solid"};G.prototype=new r;G.prototype.constructor=G;p.Solid=G;var C=function(){r.call(this);var a=new s;a.haveTarget=!1;this.layers=new t(r);this.cameras=new t(s);this.width=640;this.height=360;this.color="#000000";this.type="composition";a.align(this.width/2,this.height/2);
this.defaultCam_=a};C.prototype=new r;C.prototype.constructor=C;C.prototype.getCamera=function(){for(var a=0,b=this.cameras.getLength(),c,a=0;a<b;a+=1)if(c=this.cameras.get(a),c.visible)return c.center.set(this.width/2,this.height/2),c;c=this.defaultCam_;c.align(this.width/2,this.height/2);return c};p.Composition=C;var D=function(){r.call(this);this.text="";this.textPosition=new l;this.height=this.width=150;this.textClass=null;this.fontFamily="Arial";this.textColor="#888888";this.fontSize=18;this.lineHeight=
1.2;this.letterSpacing=0;this.textAlign="left";this.verticalAlign="top";this.collapse=!0;this.type="text"};D.prototype=new r;D.prototype.constructor=D;D.prototype.getDepthPoint=function(){var a=this.textPosition.x,b=this.textPosition.y;"center"===this.textAlign?a+=0.5*this.width:"right"===this.textAlign&&(a+=this.width);"middle"===this.verticalAlign?b+=0.5*this.height:"bottom"===this.verticalAlign&&(b+=this.height);return this.depthPoint_.set(a,b)};p.Text=D;p.AEBuilder={build:function(a){return this.buildItem(a.items[a.root],
a.items)},buildCompItem:function(a,b){var c=new C,d=new B(c),e=a.layers,f={},h={},i="",g,k,j;c.width=a.width;c.height=a.height;c.color=a.color||"#000000";d.duration=a.duration||1;d.frameRate=a.frameRate||25;for(g=0;g<e.length;g++){k=e[g];j=null;switch(k.type){case "Camera":j=this.buildCameraLayer(k);j.layer.center.set(c.width/2,c.height/2);break;case "Text":j=this.buildTextLayer(k);break;default:k.source&&(j=this.buildAVLayer(k,b))}if(j)null!=k.parent&&(f[k.parent]||(f[k.parent]=[]),f[k.parent].push(j.layer)),
h[k.id]=j.layer,d.add(j),j.layer instanceof s?c.cameras.add(j.layer):c.layers.add(j.layer)}for(i in f)if(f.hasOwnProperty(i)&&Array.isArray(f[i])&&h.hasOwnProperty(i))for(g=0;g<f[i].length;g++)f[i][g].parent=h[i];return d},buildSolidItem:function(a){var b=new G,c=new B(b);b.width=a.width;b.height=a.height;b.color=a.color;return c},buildItem:function(a,b){switch(a.type){case "Composition":return this.buildCompItem(a,b);case "Solid":return this.buildSolidItem(a,b);case "Image":return this.buildImageItem(a,
b);case "Video":return this.buildVideoItem(a,b)}},buildImageItem:function(){},buildVideoItem:function(){},buildAVLayer:function(a,b){var c=this.buildItem(b[a.source],b),d=new z(c.item,a.inPoint,a.outPoint);this.setLayerProperties(d,a);d.source=c;d.startTime=a.startTime||0;d.speed=a.speed||1;return d},buildCameraLayer:function(a){var b=new s,c=new z(b,a.inPoint,a.outPoint);b.name=b.name;b.haveTarget="none"!==a.autoOrient||"target"===a.autoOrient;this.setProp(b,"position",c,a.position);this.setProp(b,
"rotation",c,a.rotation);this.setProp(b,"orientation",c,a.orientation);this.setProp(b,"zoom",c,a.zoom);b.haveTarget&&this.setProp(b,"target",c,a.target);return c},buildTextLayer:function(a){var b=new D,c=new z(b,a.inPoint,a.outPoint),d=0,e="text,textPosition,width,height,textClass,fontFamily,textColor,fontSize,lineHeight,letterSpacing,textAlign,verticalAlign".split(","),f=e.length;for(this.setLayerProperties(c,a);d<f;d+=1)this.setProp(b,e[d],c,a[e[d]]);return c},setLayerProperties:function(a,b){var c=
a.layer;c.name=b.name;c.is3D=b.is3D||!1;if(null!=b.collapse)c.collapse=!0===b.collapse;this.setProp(c,"position",a,b.position);this.setProp(c,"anchor",a,b.anchor);this.setProp(c,"scale",a,b.scale);this.setProp(c,"opacity",a,b.opacity);c.is3D?(this.setProp(c,"rotation",a,b.rotation),this.setProp(c,"orientation",a,b.orientation)):this.setProp(c.rotation,"z",a,b.rotation)},setProp:function(a,b,c,d){if(d||0===d){var e,f,h,i,g,k,j,m;f=a[b];if(Array.isArray(d)){f=0;i=(j=d.length&&Array.isArray(d[0])&&l.isVector(d[0][0])||
l.isVector(d[0])||"object"===typeof d[0]&&l.isVector(d[0].v))?new A(a,b):new y(a,b);for(a=0;a<d.length;a++){b=d[a];g="object"===typeof b;h=(k=Array.isArray(b))||!g||b.e&&0===b.e.o;e=k?b[0]:g&&null!=b.v?b.v:b;(m=l.isVector(e))&&(e=void 0!==e.w?new u(e.x,e.y,e.z,e.w):new l(e.x,e.y,e.z));k?f=b[1]:g&&void 0!==b.d&&(f=b.d||0);e=i.add(f,e,h);if(b.e&&Array.isArray(b.e.i))e.inX=b.e.i[0],e.inY=b.e.i[1];if(b.e&&Array.isArray(b.e.o))e.outX=b.e.o[0],e.outY=b.e.o[1];if(j&&b.t){if(Array.isArray(b.t.i))e.inTangent=
new l(b.t.i[0],b.t.i[1],b.t.i[2]);if(Array.isArray(b.t.o))e.outTangent=new l(b.t.o[0],b.t.o[1],b.t.o[2]);e.update=!0}}i&&c.add(i)}else null!=d.x&&null!=d.y?(this.setProp(f,"x",c,d.x),this.setProp(f,"y",c,d.y),null!=d.z&&this.setProp(f,"z",c,d.z),null!=d.w&&this.setProp(f,"w",c,d.w)):a[b]=d}}};var N=function(a){this.element=document.createElement("solid");this.model=a};N.prototype={constructor:N,render:function(){var a=this.element.style,b=this.model;a.width=b.width+"px";a.height=b.height+"px";a.backgroundColor=
b.color}};var O=function(a){this.model=a;this.element=document.createElement("text");this.text=document.createElement("p");this.element.appendChild(this.text);this.offsetY=this.oldY=this.oldX=0;this.oldModel={text:null,textClass:null,fontFamily:null,textColor:null,fontSize:null,lineHeight:null,letterSpacing:null,textAlign:null,verticalAlign:null,width:null,height:null}};O.prototype={constructor:O,checkDifference:function(a,b){var c=!1,d,e,f;for(f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],d!==e&&("object"!==
typeof d||null===d)?(c=!0,b[f]=d):null!=d&&d.clone&&d.equals&&!d.equals(e)&&(c=!0,b[f]=d.clone()));return c},render:function(){var a=this.model,b=this.text.style,c=a.fontSize,d=a.height,e=c*a.leading-c,f=0;if(this.checkDifference(this.model,this.oldModel)){e=document.createTextNode(a.text);this.node?this.text.replaceChild(e,this.node):this.text.appendChild(e);this.node=e;b.width=a.width+"px";b.color=a.textColor;b.textAlign=a.textAlign;b.fontFamily=a.fontFamily;b.fontSize=a.fontSize+"px";b.lineHeight=
a.lineHeight+"em";for(e=c*a.lineHeight-c;6>=f&&this.text.offsetHeight-e>=d;)c*=0.92,e=c*a.lineHeight-c,b.fontSize=c+"px",f++;this.offsetY=a.textPosition.y-e/2;c=d-(this.text.offsetHeight-e/2);switch(a.verticalAlign){case "bottom":this.offsetY+=c;break;case "middle":this.offsetY+=c/2}}if(this.oldX!==a.textPosition.x)this.oldX=a.textPosition.x,b.left=this.oldX;if(this.oldY!==this.offsetY)this.oldY=this.offsetY,b.top=this.oldY}};var v=function(a){var b=a.layers.on,c;this.model=a;this.element=document.createElement("composition");
this.collapse=null;this.height=this.width=this.centerY=this.centerX=this.zoom=0;this.layers=[];var d=this;a.layers.each(function(a){if(c=d.generate(a))d.element.firstChild?d.element.insertBefore(c.element,d.element.firstChild):d.element.appendChild(c.element),d.layers.push(c)});b.add.add(this.add,this);b.remove.add(this.remove,this);b.swap.add(this.swap,this);this.matrix_=new n;this.matrix2D_=new n;this.tempMatrix_=new n};v.v1_=new l;v.v2_=new l;v.v3_=new l;v.m2D_=new q;v.prototype={constructor:v,
add:function(a,b){var c=this.generate(a),d=thid.element,e;c&&(d.hasChildNodes()||0>b?(e=d.childNodes(),d.insertBefore(c.element,e[e.length-b-1])):d.appendChild(c.element),this.layers.splice(b,0,c))},remove:function(a,b){this.element.removeChild(this.layers[b].element);this.layers.splice(b,1)},swap:function(a,b){var c=this.layers[a];this.layers[a]=this.layers[b];this.layers[b]=c},generate:function(a){var b=document.createElement("layer"),c={model:a,element:b,mask:null,scale:1,opacity:1},d=null;switch(a.type){case "composition":d=
new v(a);break;case "text":d=new O(a);break;case "solid":d=new N(a)}if(d&&d.element)b.appendChild(d.element),c.content=d.element,c.handler=d;if(!m.haveTransform&&m.haveIEFilter)b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand'); progid:DXImageTransform.Microsoft.Alpha(Opacity=100)";return c},render:function(a,b,c){var d=this.layers,e=this.layers.length,f=this.model,h=this.element.style,a=a?a:f.getCamera(),i=a.getCameraMatrix(),g=0;if(this.collapse!==f.collapse&&
(this.collapse=f.collapse,this.setCollapse(),!this.collapse))this.width=this.height=this.zoom=null;if(this.width!==f.width||this.height!==f.height)if(this.width=f.width,this.height=f.height,h.width=this.width.toFixed(4)+"px",h.height=this.height.toFixed(4)+"px",!this.collapse)h.clip="rect(0px, "+this.width+"px, "+this.height+"px, 0px)";if(!this.collapse){if(this.zoom!==a.zoom)this.zoom=a.zoom,m.have3DTransform&&(h[m.PERSPECTIVE]=this.zoom.toString()+"px");if(this.centerX!==a.center.x||this.centerY!==
a.center.y)this.centerX=a.center.x,this.centerY=a.center.y,m.have3DTransform&&(h[m.ORIGIN]=this.centerX.toString()+"px "+this.centerY.toString()+"px")}for(;g<e;g++)this.renderLayer(d[g],a,i,b,c)},renderLayer:function(a,b,c,d,e){var f=a.model,h=a.element,i=a.handler,g=a.content,k=h.style,j=f.is3D;if(a.visible!==f.visible)a.visible=f.visible,k.display=a.visible?"block":"none";if(a.visible&&i&&g){k=this.matrix_.injectMatrix(f.getMatrix());d&&j?k.multiply(d):e&&!j&&k.multiply(e);if("composition"===f.type&&
f.collapse){if(!a.collapse)a.collapse=!0,this.cleanTransform(h);g=k;j&&(g=this.matrix2D_.injectMatrix(f.getMatrix2D()),e&&g.multiply(e));i.render(b,k,g)}else if(i&&g){j&&k.multiply(c);if(f.collapse){e=k.m21;c=k.m22;d=k.m23;j=1.2*(j?Math.sqrt(e*e+c*c+d*d)*(this.zoom/(this.zoom-k.m43)):Math.sqrt(e*e+c*c));e=j/a.scale;if(1.3<e||0.77>e)a.scale=0.77<j&&1.1>j?1:j,this.setScale(g,j);j=1/a.scale;k.preMultiply(this.tempMatrix_.scaling(j,j,1))}else if(!f.collapse&&j&&1!==a.scale)a.scale=1,this.setScale(g,a.scale);
a.collapse=f.collapse;i.render();this.setMatrix(h,k,f.is3D?b:null,f.getDepthPoint(),f.width,f.height)}if(a.opacity!==f.opacity)a.opacity=f.opacity,this.setOpacity(h,f.opacity);k.identity()}},setCollapse:function(){var a=this.element.style;this.collapse?(m.have3DTransform&&(a[m.TRANSFORM_STYLE]="",a[m.PERSPECTIVE]="",a[m.PERSPECTIVE_ORIGIN]=""),a.clip="rect(auto ,auto, auto, auto)",a.overflow=""):(a.overflow="hidden",a[m.TRANSFORM_STYLE]="flat")},setScale:function(a,b){if(m.haveTransform)a.style[m.TRANSFORM]=
1!==b?"scale("+b.toFixed(4)+","+b.toFixed(4)+")":"";else if(void 0!==a.style.zoom)a.style.zoom=b},setMatrix:function(a,b,c,d){var e=a.style,f;if(m.have3DTransform)e[m.TRANSFORM]=b.toCSS();else if(f=v.m2D_,c?f.simulate3D(b,c.center,d,c.zoom):f.copy3D(b),m.haveTransform)e[m.TRANSFORM]=f.toCSS();else{if(m.haveIEFilter&&a.filters.length){b=m.getLocalBound(a);e.width=b.width+"px";e.height=b.height+"px";if(b.x||b.y)for(var c=a.childNodes,d=c.length,h=0,i;h<d;h+=1)i=c[h],i.style.left=-b.x+"px",i.style.top=
-b.y+"px";f.preTranslate(b.x,b.y);this.slideMatrixBounds(f,b);a=a.filters.item(0);a.M11=f.m11;a.M12=f.m21;a.M21=f.m12;a.M22=f.m22}e.left=f.x.toFixed(4)+"px";e.top=f.y.toFixed(4)+"px"}},slideMatrixBounds:function(a,b){var c=Math.min;a.x+=c(0,c(b.width*a.m11+b.height*a.m21,c(b.width*a.m11,b.height*a.m21)));a.y+=c(0,c(b.width*a.m12+b.height*a.m22,c(b.width*a.m12,b.height*a.m22)))},cleanTransform:function(a){a.style[m.TRANSFORM]="";a.style.filter=""},setOpacity:function(a,b){if(void 0!==a.style.opacity)a.style.opacity=
1!==b?b:"";else if(m.haveIEFilter&&2===a.filters.length)a.filters.item(1).Opacity=100*b}};var S=function(a,b){this.scene=new v(a);this.camera=b;this.element=document.createElement("scene");this.element.appendChild(this.scene.element);if(!document.getElementById("AEStyleSheet")){var c=document.createElement("style");c.id="AEStyleSheet";c.type="text/css";c.rel="stylesheet";c.media="screen";c.title="AEStyleSheet";c.styleSheet?(c.styleSheet.cssText="scene * {position:absolute;display:block;top:0px;left:0px;margin:0px;padding:0px;border:0px;word-wrap:break-word;-webkit-font-smoothing:antialiased;transform-origin:0% 0%;-o-transform-origin:0% 0%;-khtml-transform-origin:0% 0%;-moz-transform-origin:0% 0%;-webkit-transform-origin:0% 0%;-ms-transform-origin:0% 0%;}scene layer {-ms-filter: \"progid:DXImageTransform.Microsoft.Matrix(M11='2.0', sizingMethod='auto expand')\"}scene solid {position: absolute}",
console.log(c.styleSheet.cssText)):c.innerHTML="scene * {position:absolute;display:block;top:0px;left:0px;margin:0px;padding:0px;border:0px;word-wrap:break-word;-webkit-font-smoothing:antialiased;transform-origin:0% 0%;-o-transform-origin:0% 0%;-khtml-transform-origin:0% 0%;-moz-transform-origin:0% 0%;-webkit-transform-origin:0% 0%;-ms-transform-origin:0% 0%;}scene layer {-ms-filter: \"progid:DXImageTransform.Microsoft.Matrix(M11='2.0', sizingMethod='auto expand')\"}scene solid {position: absolute}";
document.getElementsByTagName("head")[0].appendChild(c)}if(a.color)this.scene.element.style.backgroundColor=a.color};S.prototype.render=function(){this.scene.render()};p.DomRenderer=S;"function"===typeof define&&define.amd?define("AE",[],p):"undefined"!==typeof module&&module.exports?module.exports=p:T.AE=p})(this);