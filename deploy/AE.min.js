/*

 Released under the MIT license
 Author: Yannick Connan
 Version: 0.1.1 - Build: 17698 (2012/04/22 07:54 PM)
*/
(function(S){var n={VERSION:"0.1.1"};(function(a){function b(a,b,c,d,f){this._listener=b;this._isOnce=c;this.context=d;this._signal=a;this._priority=f||0}function c(a,b){if("function"!==typeof a)throw Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b));}var d={VERSION:"0.7.1"};b.prototype={active:!0,params:null,execute:function(a){var b;this.active&&this._listener&&(a=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,a),this._isOnce&&this.detach());
return b},detach:function(){return this.isBound()?this._signal.remove(this._listener):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal;delete this._listener;delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}};d.Signal=function(){this._bindings=[];this._prevParams=null};
d.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,c,d,i){var f=this._indexOfListener(a);if(-1!==f){if(a=this._bindings[f],a.isOnce()!==c)throw Error("You cannot add"+(c?"":"Once")+"() then add"+(!c?"":"Once")+"() the same listener without removing the relationship first.");}else a=new b(this,a,c,d,i),this._addBinding(a);this.memorize&&this._prevParams&&a.execute(this._prevParams);return a},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&
a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a){for(var b=this._bindings.length;b--;)if(this._bindings[b]._listener===a)return b;return-1},has:function(a){return-1!==this._indexOfListener(a)},add:function(a,b,d){c(a,"add");return this._registerListener(a,!1,b,d)},addOnce:function(a,b,d){c(a,"addOnce");return this._registerListener(a,!0,b,d)},remove:function(a){c(a,"remove");var b=this._indexOfListener(a);-1!==b&&(this._bindings[b]._destroy(),
this._bindings.splice(b,1));return a},removeAll:function(){for(var a=this._bindings.length;a--;)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(this.active){var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;if(this.memorize)this._prevParams=b;if(c){d=this._bindings.slice();this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&!1!==d[c].execute(b))}}},
forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};"function"===typeof define&&define.amd?define("signals",[],d):"undefined"!==typeof module&&module.exports?module.exports=d:a.signals=d})(this);var L=this.signals;if(!Function.prototype.bind)Function.prototype.bind=function(a){var b=this;if("function"!==typeof b)throw new TypeError("Function.prototype.bind called on incompatible "+
b);var c=slice.call(arguments,1),d=function(){if(this instanceof d){var e=function(){};e.prototype=b.prototype;var e=new e,g=b.apply(e,c.concat(slice.call(arguments)));return Object(g)===g?g:e}return b.apply(a,c.concat(slice.call(arguments)))};return d};if(!Array.isArray)Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)};if(!Array.prototype.indexOf)Array.prototype.indexOf=function(a){var b,c;"a"!="a"[0]&&"string"==typeof o&&o&&(b=this.split(""));b=Object(this);c=
b.length>>>0;if(!c)return-1;var d=0;1<arguments.length&&(d=toInteger(arguments[1]));for(d=0<=d?d:Math.max(0,c+d);d<c;d++)if(d in b&&b[d]===a)return d;return-1};var B=function(a){return a.charAt(0).toUpperCase()+a.substr(1)},O=function(a){for(var b=[a],c=0,d=F.length,a=B(a);c<d;c+=1)b.push(F[c]+a);return b},F="Webkit Moz O ms Khtml".split(" "),p={TRANSFORM:"Transform",TRANSFORM_STYLE:"transformStyle",PERSPECTIVE:"perspective",ORIGIN:"perspectiveOrigin"};p.haveTransform=function(){var a=document.createElement("div"),
b=O(this.TRANSFORM),c=0,d=b.length;if(a)for(;c<d;c+=1)if(c&&void 0!==a.style[b[c]])return this.TRANSFORM=F[c-1]+B(this.TRANSFORM),!0;return!1}.call(p);p.have3DTransform=function(){var a=document.createElement("div"),b=O(this.PERSPECTIVE),c=0,d=b.length;if(a)for(;c<d;c+=1)if(c&&void 0!==a.style[b[c]])return a=F[c-1],this.PERSPECTIVE=a+B(this.PERSPECTIVE),this.ORIGIN=a+B(this.ORIGIN),this.TRANSFORM_STYLE=a+B(this.TRANSFORM_STYLE),!0;return!1}.call(p);n.Browser=p;var G=function(a,b,c,d){var e=0.5*(b-
a),a=0.5*(a+b),b=d.clone();sum=0.3478548451*b.multiplyScalar(2*(a+-0.8611363116*e)).add(c).lengthSq();sum+=0.3478548451*b.copy(d).multiplyScalar(2*(a+0.8611363116*e)).add(c).lengthSq();sum+=0.6521451549*b.copy(d).multiplyScalar(2*(a+-0.3399810436*e)).add(c).lengthSq();return sum+=0.6521451549*b.copy(d).multiplyScalar(2*(a+0.3399810436*e)).add(c).lengthSq()},P=function(a,b,c,d,e,g){var h=a.clone(),i=d.clone();if(c.equals(d))return e.curveTo(h.lerp(b,0.89),d),e;if(b.equals(a))return e.curveTo(i.lerp(c,
0.89),d),e;h.lerp(b,1.5);i.lerp(c,1.5);g||(g=(Math.max(Math.max(h.max(),i.max()),Math.max(a.max(),d.max()))-Math.min(Math.min(h.min(),i.min()),Math.min(a.min(),d.min())))/350);var f=Math.sqrt(10.3923048/h.distance(i)*g);if(1<f)e.curveTo(h.lerp(i,0.5),d);else{var a=a.clone(),j=a.clone().lerp(b,f),l=c.clone().lerp(d,f),t=b.clone().lerp(c,f),m=j.clone().lerp(t,f),b=t.lerp(l,f),k=m.clone().lerp(b,f),h=a.clone().lerp(j,1.5);i.copy(k).lerp(m,1.5);e.curveTo(h.lerp(i,0.5),k.clone());0.5>f&&(f=1-f/(1-f),b=
b.clone(),c=l.clone(),a.copy(k),j.copy(a).lerp(b,f),l.copy(c).lerp(d,f),t.copy(b).lerp(c,f),m.copy(j).lerp(t,f),b=t.lerp(l,f),k.copy(m).lerp(b,f),P(a,j,m.clone(),k.clone(),e,g));h=k.clone().lerp(b,1.5);i=d.clone().lerp(l,1.5);e.curveTo(h.lerp(i,0.5),d.clone())}return e},Q=function(a){if(!(a instanceof this.type_))throw"not the right type";},s=function(a){this.items_=[];this.type_=Object;if(a&&a.prototype instanceof this.type_)this.type_=a;this.on={add:new L.Signal,remove:new L.Signal,swap:new L.Signal}};
s.prototype={constructor:s,items_:null,type_:null,index:function(a){return this.items_.indexOf(a)},have:function(a){return-1!==this.index(a)},get:function(a){return this.items_[a]},getLength:function(){return this.items_.length},add:function(a){Q.call(this,a);if(this.have(a))throw"item already present";this.items_.push(a);this.on.add.dispatch(a,this.length-1,this)},insert:function(a,b){Q.call(this,a);var c=this.items_;if(this.have(a))throw"item already present";b<c.length?c.splice(b,0,a):c.push(a);
c=Math.max(b,this.length-1);this.on.add.dispatch(a,c,this)},remove:function(a){var b=this.items_,c=b.indexOf(a);if(-1!==c)b.splice(c,1),this.on.remove.dispatch(a,c,this);else throw"item not present";},swap:function(a,b){var c=this.items_,d=c.indexOf(a),e=c.indexOf(b);if(-1!==d&&-1!==e)c[d]=b,c[e]=a,this.on.swap.dispatch(d,e,this);else throw"one of the items not present";},each:function(a){for(var b=this.items_,c=b.length,d=0;d<c;d++)a(b[d])}};n.Stack=s;var T={ease:function(a,b,c,d,e,g){b=b||0;d=d||
0;a=this.solveCurveX(a||0,c||0,e||0,g);c=3*b;b=3*(d-b)-c;return(((1-c-b)*a+b)*a+c)*a},solveCurveX:function(a,b,c,d){var e=this.fabs,g=3*a,a=3*(b-a)-g,b=1-g-a,h=2*a,i=3*b,f,j,l,t;d||(d=1.0E-4);f=c;t=0;a:for(;8>t;t++){j=((b*f+a)*f+g)*f-c;if(e(j)<d)return f;l=(i*f+h)*f+g;if(1.0E-6>e(l))break a;f-=j/l}h=0;i=1;f=c;if(f<h)return h;if(f>i)return i;for(t=0;h<i&&10>t;){j=((b*f+a)*f+g)*f;if(e(j-c)<d)break;c>j?h=f:i=f;f=0.5*(i-h)+h;t++}return f},fabs:function(a){return 0<=a?a:0-a}},k=function(a,b,c){this.x=
a||0;this.y=b||0;this.z=c||0};k.isVector=function(a){return a&&"number"===typeof a.x&&"number"===typeof a.y};k.prototype={constructor:k,set:function(a,b,c){this.x=a;this.y=b;this.z=c;return this},setX:function(a){this.x=a;return this},setY:function(a){this.y=a;return this},setZ:function(a){this.z=a;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z||0;return this},clone:function(){return new k(this.x,this.y,this.z)},add:function(a){this.x+=a.x;this.y+=a.y;this.z+=a.z;return this},addScalar:function(a){this.x+=
a;this.y+=a;this.z+=a;return this},sub:function(a){this.x-=a.x;this.y-=a.y;this.z-=a.z;return this},multiply:function(a){this.x*=a.x;this.y*=a.y;this.z*=a.z;return this},multiplyScalar:function(a){this.x*=a;this.y*=a;this.z*=a;return this},divide:function(a){this.x/=a.x;this.y/=a.y;this.z/=a.z;return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a):this.z=this.y=this.x=0;return this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+
this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lerp:function(a,b){this.x+=(a.x-this.x)*b;this.y+=(a.y-this.y)*b;this.z+=(a.z-this.z)*b;return this},cross:function(a){var b=this.x,c=this.y,d=this.z;this.x=c*a.z-d*a.y;this.y=d*a.x-b*a.z;this.z=b*a.y-c*a.x;return this},distance:function(a){return Math.sqrt(this.distanceSq(a))},distanceSq:function(a){return this.clone().sub(a).lengthSq()},equals:function(a){return a.x===
this.x&&a.y===this.y&&a.z===this.z},isZero:function(){return 1.0E-4>this.lengthSq()},max:function(){return Math.max(this.x,Math.max(this.y,this.z))},min:function(){return Math.min(this.x,Math.min(this.y,this.z))},setFromQuaternion:function(a){this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),a.w*a.w-a.x*a.x-a.y*a.y+a.z*a.z);this.y=Math.asin(2*(a.x*a.z+a.y*a.w));this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),a.w*a.w+a.x*a.x-a.y*a.y-a.z*a.z)}};n.Vector=k;var m=function(){arguments.length&&this.injectArray(arguments)};m.tMat_=
new m;m.tVec1_=new k;m.tVec2_=new k;m.tVec3_=new k;m.prototype={constructor:m,m11:1,m12:0,m13:0,m14:0,m21:0,m22:1,m23:0,m24:0,m31:0,m32:0,m33:1,m34:0,m41:0,m42:0,m43:0,m44:1,set:function(a,b,c,d,e,g,h,i,f,j,l,t,m,k,n,p){this.m11=a;this.m12=b;this.m13=c;this.m14=d;this.m21=e;this.m22=g;this.m23=h;this.m24=i;this.m31=f;this.m32=j;this.m33=l;this.m34=t;this.m41=m;this.m42=k;this.m43=n;this.m44=p;return this},injectArray:function(a){return this.set.apply(this,a)},injectMatrix:function(a){this.m11=a.m11;
this.m12=a.m12;this.m13=a.m13;this.m14=a.m14;this.m21=a.m21;this.m22=a.m22;this.m23=a.m23;this.m24=a.m24;this.m31=a.m31;this.m32=a.m32;this.m33=a.m33;this.m34=a.m34;this.m41=a.m41;this.m42=a.m42;this.m43=a.m43;this.m44=a.m44;return this},identity:function(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},translation:function(a,b,c){this.set(1,0,0,0,0,1,0,0,0,0,1,0,a||0,b||0,c||0,1);return this},translate:function(a,b,c){this.m41+=a||0;this.m42+=b||0;this.m43+=c||0;return this},scaling:function(a,
b,c){this.set(a||0,0,0,0,0,b||0,0,0,0,0,c||0,0,0,0,0,1);return this},scale:function(a,b,c){a=a||1.0E-6;b=b||1.0E-6;c=c||1.0E-6;if(1!==a||1!==b||1!==c)this.m11*=a,this.m21*=a,this.m31*=a,this.m41*=a,this.m12*=b,this.m22*=b,this.m32*=b,this.m42*=b,this.m13*=c,this.m23*=c,this.m33*=c,this.m43*=c;return this},rotation:function(a,b,c){this.identity();var d=Math.PI/180,a=(a||0)*d,b=(b||0)*d,c=(-c||0)*d,e=Math.cos,g=Math.sin,d=e(a),a=g(a),h=e(b),b=g(b),e=e(c),c=g(c),g=d*e,i=d*c,f=a*e,j=a*c;this.m11=h*e;
this.m12=f*b-i;this.m13=g*b+j;this.m21=h*c;this.m22=j*b+g;this.m23=i*b-f;this.m31=-b;this.m32=a*h;this.m33=d*h;this.m41=this.m42=this.m43=0;return this},rotate:function(a,b,c){if(!this.temp_)this.temp_=new m;return a||b||c?this.multiply(this.temp_.rotation(a,b,c)):this},quaternionRotation:function(a,b,c,d){var e=d*d,g=a*a,h=b*b,i=c*c,f=1/(g+h+i+e);this.m11=(g-h-i+e)*f;this.m22=(-g+h-i+e)*f;this.m33=(-g-h+i+e)*f;e=a*b;g=c*d;this.m21=2*(e+g)*f;this.m12=2*(e-g)*f;e=a*c;g=b*d;this.m31=2*(e-g)*f;this.m13=
2*(e+g)*f;e=b*c;g=a*d;this.m32=2*(e+g)*f;this.m23=2*(e-g)*f;return this},quaternionRotate:function(a,b,c,d){if(!this.temp_)this.temp_=new m;return this.multiply(this.temp_.quaternionRotation(a,b,c,!d&&0!==d?1:d))},lookingAt:function(a,b,c){var d=m.tVec1_.set(0,1,0),e=m.tVec2_,a=m.tVec3_.set(-a,-b,c).normalize();d.cross(a);e.copy(a).cross(d);d.normalize();e.normalize();this.set(d.x,d.y,d.z,0,e.x,e.y,e.z,0,a.x,a.y,a.z,0,0,0,0,1);return this},lookAt:function(a,b,c){if(!this.temp_)this.temp_=new m;return a||
b?this.multiply(this.temp_.lookingAt(a,b,c)):this},determinant:function(){return-this.m13*this.m22*this.m31+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m11*this.m23*this.m32-this.m12*this.m21*this.m33+this.m11*this.m22*this.m33},invert:function(){var a=this.m11,b=this.m12,c=this.m13,d=this.m21,e=this.m22,g=this.m23,h=this.m31,i=this.m32,f=this.m33,j=this.m41,l=this.m42,m=this.m43,k=1/this.determinant();this.m11=(-g*i+e*f)*k;this.m12=(c*i-b*f)*k;this.m13=(-c*e+b*g)*k;this.m14=0;this.m21=
(g*h-d*f)*k;this.m22=(-c*h+a*f)*k;this.m23=(c*d-a*g)*k;this.m24=0;this.m31=(-e*h+d*i)*k;this.m32=(b*h-a*i)*k;this.m33=(-b*d+a*e)*k;this.m34=0;this.m41=(g*i*j-e*f*j-g*h*l+d*f*l+e*h*m-d*i*m)*k;this.m42=(b*f*j-c*i*j+c*h*l-a*f*l-b*h*m+a*i*m)*k;this.m43=(c*e*j-b*g*j-c*d*l+a*g*l+b*d*m-a*e*m)*k;this.m44=1;return this},createInvert:function(){return this.clone().invert()},clone:function(){return(new m).set(this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,
this.m34,this.m41,this.m42,this.m43,this.m44)},join:function(a,b){var c=a.m11,d=a.m12,e=a.m13,g=a.m14,h=a.m21,i=a.m22,f=a.m23,j=a.m24,l=a.m31,k=a.m32,m=a.m33,n=a.m34,p=a.m41,q=a.m42,r=a.m43,s=a.m44,u=b.m11,v=b.m12,w=b.m13,x=b.m14,y=b.m21,z=b.m22,A=b.m23,B=b.m24,C=b.m31,D=b.m32,E=b.m33,F=b.m34,G=b.m41,H=b.m42,I=b.m43,J=b.m44;this.m11=c*u+d*y+e*C+g*G;this.m12=c*v+d*z+e*D+g*H;this.m13=c*w+d*A+e*E+g*I;this.m14=c*x+d*B+e*F+g*J;this.m21=h*u+i*y+f*C+j*G;this.m22=h*v+i*z+f*D+j*H;this.m23=h*w+i*A+f*E+j*I;
this.m24=h*x+i*B+f*F+j*J;this.m31=l*u+k*y+m*C+n*G;this.m32=l*v+k*z+m*D+n*H;this.m33=l*w+k*A+m*E+n*I;this.m34=l*x+k*B+m*F+n*J;this.m41=p*u+q*y+r*C+s*G;this.m42=p*v+q*z+r*D+s*H;this.m43=p*w+q*A+r*E+s*I;this.m44=p*x+q*B+r*F+s*J;return this},multiply:function(a){return this.join(this,a)},preMultiply:function(a){return this.join(a,this)},toCSS:function(){return"matrix3d("+this.m11.toFixed(4)+","+this.m12.toFixed(4)+","+this.m13.toFixed(4)+","+this.m14.toFixed(4)+","+this.m21.toFixed(4)+","+this.m22.toFixed(4)+
","+this.m23.toFixed(4)+","+this.m24.toFixed(4)+","+this.m31.toFixed(4)+","+this.m32.toFixed(4)+","+this.m33.toFixed(4)+","+this.m34.toFixed(4)+","+this.m41.toFixed(4)+","+this.m42.toFixed(4)+","+this.m43.toFixed(4)+","+this.m44.toFixed(4)+")"},toArray:function(){return[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44]}};n.Matrix=m;var u=function(a,b,c,d){this.x=a||0;this.y=b||0;this.z=c||0;this.w=d||1};
u.isQuaternion=function(a){return a&&"number"===typeof a.x&&"number"===typeof a.y&&"number"===typeof a.w};u.prototype={constructor:u,set:function(a,b,c,d){this.x=a;this.y=b;this.z=c||0;this.w=!d&&0!==d?1:d;return this},copy:function(a){this.x=a.x;this.y=a.y;this.z=a.z||0;this.w=a.w||1;return this},clone:function(){return new u(this.x,this.y,this.z,this.w)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},multiply:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;
this.w=e*a.w-b*a.x-c*a.y-d*a.z;this.x=e*a.x+b*a.w+c*a.z-d*a.y;this.y=e*a.y+c*a.w+d*a.x-b*a.z;this.z=e*a.z+d*a.w+b*a.y-c*a.x;return this},setFromEuler:function(a){var b=Math.sin,c=Math.cos,d=Math.PI/360,e=a.x*d,g=a.y*d,h=a.z*d,a=c(g),g=b(g),d=c(-h),h=b(-h),c=c(e),b=b(e);if(!this.temp_)this.temp_=new u;this.set(0,0,h,d).multiply(this.temp_.set(0,g,0,a)).multiply(this.temp_.set(b,0,0,c));return this},divideScalar:function(a){a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):this.w=this.z=this.y=this.x=0;return this},
lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lerp:function(a,b){var c=this.x,d=this.y,e=this.z,g=this.w,h=g*a.w+c*a.x+d*a.y+e*a.z,i,f;0>h?(this.set(-a.x,-a.y,-a.z,-a.w),h=-h):this.copy(a);i=Math.acos(h);f=Math.sqrt(1-h*h);if(0.0010>Math.abs(f))return this.set(0.5*(c+a.x),0.5*(d+a.y),0.5*(e+a.z),0.5*(g+a.w)),this;h=Math.sin((1-b)*i)/f;i=Math.sin(b*
i)/f;this.set(c*h+this.x*i,d*h+this.y*i,e*h+this.z*i,g*h+this.w*i);return this},toJSON:function(){return{x:this.x,y:this.y,z:this.z,w:this.w}}};n.Quaternion=u;var H=function(a,b){this.start=a;this.end=b;this.update=!0};H.prototype={constructor:H,length:function(){if(this.update)this.length_=this.start.distance(this.end),this.update=!1;return this.length_},getVect:function(a,b){return(b?b.copy(this.start):this.start.clone()).lerp(this.end,a)}};n.Line=H;var I=function(a,b,c){this.start=a;this.anchor=
b;this.end=c;this.temp_=this.start.clone();this.update=!0};I.prototype={constructor:I,length:function(){if(this.update){this.update=!1;var a=this.anchor.clone().sub(this.start).multiplyScalar(2),b=this.start.clone().sub(this.anchor.clone().multiplyScalar(2)).add(this.end),c=Math.sqrt,d,e,g;d=c(G(0,0.25,a,b))/5.65685425;e=c(G(0.25,0.5,a,b))/5.65685425;g=c(G(0.5,0.75,a,b))/5.65685425;a=d+e+g+c(G(0.75,1,a,b))/5.65685425;g=(d+e+g)/a;e=(d+e)/a;d/=a;this.length_=a;this.inverse_=[d,e,g,0.5+(1-d/(e-d))/4,
0.5-(1-(1-g)/(g-e))/5]}return this.length_},getVect:function(a,b){this.length();var c,d=this.inverse_,e,g;e=d[0];g=d[1];var h=d[2];c=d[3];d=d[4];a>=h?(e=(a-h)/(1-h),c=d,g=0.75):a>=g?(e=(a-g)/(h-g),g=0.5,c=d):a>=e?(e=(a-e)/(g-e),g=0.25):(e=a/e,g=0);c=0.25*(2*(1-e)*e*c+e*e)+g;return(b?b.copy(this.start):this.start.clone()).lerp(this.anchor,c).lerp(this.temp_.copy(this.anchor).lerp(this.end,c),c)}};n.QuadCurve=I;var J=function(a){this.start=a||0;this.elements=[];this.update=!0};J.prototype={constructor:J,
length:function(){if(this.update){var a=0,b=this.elements.length,c;this.update=!1;this.lengths_=[a];for(c=0;c<b;c++)a+=this.elements[c].length(),this.lengths_.push(a);this.lastItemPos_=this.lastPos_=0;this.length_=a}return this.length_},getItem:function(a){for(var a=a*this.length(),b=a>=this.lastPos_?1:-1,c=this.elements.length,d,e,g=this.lastItemPos_;g<c;g+=b)if(d=this.lengths_[g],e=this.elements[g],a>=d&&a<d+e.length())return this.lastItemPos_=g,this.lastPos_=d,e},getVect:function(a,b){var c=this.getItem(a),
a=a*this.length();return c?c.getVect((a-this.lastPos_)/c.length(),b):b?b.copy(this.start):this.start.clone()},lineTo:function(a){this.elements.push(new H(this.start,a));this.start=a;this.update=!0},curveTo:function(a,b){this.elements.push(new I(this.start,a,b));this.start=b;this.update=!0},cubicCurveTo:function(a,b,c){this.elements.push(new C(this.start,a,b,c));this.start=c;this.update=!0}};n.Path=J;var C=function(a,b,c,d){this.start=a;this.a1=b;this.a2=c;this.end=d;this.update=!0};C.prototype={constructor:C,
length:function(){if(this.update)this.update=!1,this.path=P(this.start,this.a1,this.a2,this.end,new J(this.start)),this.length_=this.path.length();return this.length_},getVect:function(a,b){this.length();return this.path.getVect(a,b)}};n.CubicCurve=C;var x=function(a,b,c,d){s.call(this);this.layer=a;this.inPoint=b||0;this.outPoint=c||1/0;this.source=d;this.startTime=0;this.speed=1;this.remap=new w};x.prototype=new s;x.prototype.constructor=x;x.prototype.animate=function(a){var b=this.layer,c=this.items_;
if(a>=this.inPoint&&a<=this.outPoint){b.visible=!0;for(var b=c.length,d=0;d<b;d++)c[d].set(a);this.source&&(this.remap.num()?this.source.animate(this.remap.get(a-this.startTime)):this.source.animate((a-this.startTime)*this.speed))}else b.visible=!1};var z=function(a){s.call(this);this.item=a;this.duration=1;this.frameRate=25;this.clamp=!1};z.prototype=new s;z.prototype.constructor=z;z.prototype.animate=function(a){var b=this.items_,c=b.length,a=a%this.duration;this.clamp&&(a=Math.floor(a*this.frameRate)/
this.frameRate);if(a!==this.prevTime_){for(var d=0;d<c;d++)b[d].animate(a);this.prevTime_=a}};var U=function(a,b,c){this.offset=a;this.position_=0;this.value=b;this.isHold=c;this.outY=this.outX=this.inY=this.inX=0;this.path=this.outTangent=this.inTangent=null;this.update=!1},w=function(a,b){this.target=a;this.property=b;this.keys_=[];this.length_=0};w.prototype={constructor:w,length:function(){var a=this.keys_,b,c,d,e;if(this.update){d=a.length;for(c=e=0;c<d;c++)if(b=a[c],e+=b.offset,b.position_=
e,b.update&&b.path&&(b.inTangent||b.outTangent))this.path=null,b.update=!1;this.length_=e;this.update=!1}return this.length_},num:function(){return this.keys_.length},indexAt:function(a){var b=this.keys_,c=this.prevIndex_||0,d=a>=(this.prevPosition_||0)?1:-1;this.length();this.prevPosition_=a;if(a<=b[0].position_)return this.prevIndex_=0;if(a>=b[b.length-1].position_)return this.prevIndex_=b.length-1;for(;b[c];){if(a>=b[c].position_&&(!b[c+1]||a<b[c+1].position_))return this.prevIndex_=c,this.prevPosition_=
a,this.prevIndex_;c+=d}return this.prevIndex_=0},get:function(a,b){var c=this.indexAt(a),d=this.keys_[c],e;if(0===c&&a<=d.offset||c>=this.num()-1||d.isHold)return d.value;c=this.keys_[c+1];e=(a-d.position_)/c.offset;if(d.outX||d.outY||c.inX||c.inY)e=T.ease(d.outX,d.outY,c.inX,c.inY,e);return this.interpolate(d,c,e,b)},interpolate:function(a,b,c){return a.value+(b.value-a.value)*c},set:function(a){a=this.get(a);this.target[this.property]!==a&&(this.target[this.property]=a)},add:function(a,b,c){b=new U(a,
b,c);this.length_+=a;b.position_=this.length_;this.keys_.push(b);return b}};n.Keys=w;var y=function(a,b){w.call(this,a,b);this.temp_=a[b].clone()};y.prototype=new w;y.prototype.constructor=y;y.prototype.interpolate=function(a,b,c,d){if(a.update)a.path=a.outTangent&&b.inTangent?new C(a.value,a.outTangent.clone().add(a.value),b.inTangent.clone().add(b.value),b.value):null,a.update=!1;return a.path?a.path.getVect(c,d):(d?d.copy(a.value):a.value.clone()).lerp(b.value,c)};y.prototype.set=function(a){var a=
this.get(a,this._temp),b=this.target[this.property];b.equals&&!b.equals(a)&&b.copy(a)};n.SpatialKeys=y;var v=function(){this.is3D=!0;this.parent=null;this.visible=!0;this.name=null;this.type="null";this.matrix_=new m;this.matrix2D_=new m};v.prototype.getMatrix=function(){if(!this.is3D)return this.getMatrix2D();var a=this.matrix_.injectMatrix(this.getLocalMatrix()),b=this.parent;b&&b!==this&&a.multiply(b.getMatrix());return a};v.prototype.getMatrix2D=function(){var a=this.matrix2D_.injectMatrix(this.getLocalMatrix2D()),
b=this.parent;b&&a.multiply(b.getMatrix2D());return a};v.prototype.getLocalMatrix=function(){return new m};v.prototype.getLocalMatrix2D=function(){return new m};var q=function(){v.call(this);this.filters=new s;this.masks=new s;this.collapse=!1;this.position=new k;this.anchor=new k;this.scale=new k(1,1,1);this.rotation=new k;this.orientation=new u;this.opacity=1;this.type="null";this.localMatrix_=new m;this.localMatrix2D_=new m};q.prototype=new v;q.prototype.constructor=q;q.prototype.getLocalMatrix=
function(){var a=this.position,b=this.anchor,c=this.scale,d=this.rotation,e=this.orientation;return this.localMatrix_.translation(-b.x,-b.y,b.z).scale(c.x,c.y,c.z).rotate(d.x,d.y,d.z).quaternionRotate(e.x,e.y,e.z,e.w).translate(a.x,a.y,-a.z)};q.prototype.getLocalMatrix2D=function(){var a=this.position,b=this.anchor,c=this.scale;return this.localMatrix2D_.translation(-b.x,-b.y,0).scale(c.x,c.y,1).rotate(0,0,this.rotation.z).translate(a.x,a.y,0)};n.Layer=q;var r=function(){v.call(this);this.position=
new k;this.rotation=new k;this.orientation=new u;this.target=new k;this.haveTarget=!0;this.zoom=1333.33;this.center=new k;this.is3D=!0;this.type="camera";this.localMatrix_=new m;this.localMatrix2D_=new m;this.matrixCamera_=new m;this.tempMatrixCamera_=new m};r.prototype=new v;r.prototype.constructor=r;r.prototype.getLocalMatrix=function(){var a=this.rotation,b=this.target,c=this.position,d=this.orientation,a=this.localMatrix_.rotation(a.x,a.y,a.z);a.m41=a.m42=a.m43=0;a.quaternionRotate(d.x,d.y,d.z,
d.w);this.haveTarget&&a.lookAt(b.x-c.x,b.y-c.y,b.z-c.z);a.translate(c.x,c.y,-c.z);return a};r.prototype.getLocalMatrix2D=function(){return this.localMatrix2D_.rotation(0,0,this.rotation.z).translate(this.position.x,this.position.y,0)};r.prototype.getCameraMatrix=function(){var a=this.center;return this.matrixCamera_.translation(a.x,a.y,this.zoom).preMultiply(this.tempMatrixCamera_.identity().injectMatrix(this.getMatrix()).invert())};r.prototype.align=function(a,b){this.center.x=this.position.x=a;
this.center.y=this.position.y=b;this.position.z=-this.zoom};n.Camera=r;var D=function(){q.call(this);this.color="#000000";this.width=640;this.height=360;this.type="solid"};D.prototype=new q;D.prototype.constructor=D;n.Solid=D;var A=function(){q.call(this);var a=new r;a.haveTarget=!1;this.layers=new s(q);this.cameras=new s(r);this.width=640;this.height=360;this.color="#000000";this.type="composition";a.align(this.width/2,this.height/2);this.defaultCam_=a};A.prototype=new q;A.prototype.constructor=
A;A.prototype.getCamera=function(){for(var a=0,b=this.cameras.getLength(),c,a=0;a<b;a+=1)if(c=this.cameras.get(a),c.visible)return c.center.set(this.width/2,this.height/2),c;c=this.defaultCam_;c.align(this.width/2,this.height/2);return c};n.Composition=A;var E=function(){q.call(this);this.text="";this.textPosition=new k;this.height=this.width=150;this.textClass=null;this.fontFamily="Arial";this.textColor="#888888";this.fontSize=18;this.lineHeight=1.2;this.letterSpacing=0;this.textAlign="left";this.verticalAlign=
"top";this.collapse=!0;this.type="text"};E.prototype=new q;E.prototype.constructor=E;n.Text=E;n.AEBuilder={build:function(a){return this.buildItem(a.items[a.root],a.items)},buildCompItem:function(a,b){var c=new A,d=new z(c),e=a.layers,g={},h={},i="",f,j,l;c.width=a.width;c.height=a.height;c.color=a.color||"#000000";d.duration=a.duration||1;d.frameRate=a.frameRate||25;for(f=0;f<e.length;f++){j=e[f];l=null;switch(j.type){case "Camera":l=this.buildCameraLayer(j);l.layer.center.set(c.width/2,c.height/
2);break;case "Text":l=this.buildTextLayer(j);break;default:j.source&&(l=this.buildAVLayer(j,b))}if(l)null!=j.parent&&(g[j.parent]||(g[j.parent]=[]),g[j.parent].push(l.layer)),h[j.id]=l.layer,d.add(l),l.layer instanceof r?c.cameras.add(l.layer):c.layers.add(l.layer)}for(i in g)if(g.hasOwnProperty(i)&&Array.isArray(g[i])&&h.hasOwnProperty(i))for(f=0;f<g[i].length;f++)g[i][f].parent=h[i];return d},buildSolidItem:function(a){var b=new D,c=new z(b);b.width=a.width;b.height=a.height;b.color=a.color;return c},
buildItem:function(a,b){switch(a.type){case "Composition":return this.buildCompItem(a,b);case "Solid":return this.buildSolidItem(a,b);case "Image":return this.buildImageItem(a,b);case "Video":return this.buildVideoItem(a,b)}},buildImageItem:function(){},buildVideoItem:function(){},buildAVLayer:function(a,b){var c=this.buildItem(b[a.source],b),d=new x(c.item,a.inPoint,a.outPoint);this.setLayerProperties(d,a);d.source=c;d.startTime=a.startTime||0;d.speed=a.speed||1;return d},buildCameraLayer:function(a){var b=
new r,c=new x(b,a.inPoint,a.outPoint);b.name=b.name;b.haveTarget="none"!==a.autoOrient||"target"===a.autoOrient;this.setProp(b,"position",c,a.position);this.setProp(b,"rotation",c,a.rotation);this.setProp(b,"orientation",c,a.orientation);this.setProp(b,"zoom",c,a.zoom);b.haveTarget&&this.setProp(b,"target",c,a.target);return c},buildTextLayer:function(a){var b=new E,c=new x(b,a.inPoint,a.outPoint),d=0,e="text,textPosition,width,height,textClass,fontFamily,textColor,fontSize,lineHeight,letterSpacing,textAlign,verticalAlign".split(","),
g=e.length;for(this.setLayerProperties(c,a);d<g;d+=1)this.setProp(b,e[d],c,a[e[d]]);return c},setLayerProperties:function(a,b){var c=a.layer;c.name=b.name;c.is3D=b.is3D||!1;if(null!=b.collapse)c.collapse=!0===b.collapse;this.setProp(c,"position",a,b.position);this.setProp(c,"anchor",a,b.anchor);this.setProp(c,"scale",a,b.scale);this.setProp(c,"opacity",a,b.opacity);c.is3D?(this.setProp(c,"rotation",a,b.rotation),this.setProp(c,"orientation",a,b.orientation)):this.setProp(c.rotation,"z",a,b.rotation)},
setProp:function(a,b,c,d){if(d||0===d){var e,g,h,i,f,j,l,m;g=a[b];if(Array.isArray(d)){g=0;i=(l=d.length&&Array.isArray(d[0])&&k.isVector(d[0][0])||k.isVector(d[0])||"object"===typeof d[0]&&k.isVector(d[0].v))?new y(a,b):new w(a,b);for(a=0;a<d.length;a++){b=d[a];f="object"===typeof b;h=(j=Array.isArray(b))||!f||b.e&&0===b.e.o;e=j?b[0]:f&&null!=b.v?b.v:b;(m=k.isVector(e))&&(e=void 0!==e.w?new u(e.x,e.y,e.z,e.w):new k(e.x,e.y,e.z));j?g=b[1]:f&&void 0!==b.d&&(g=b.d||0);e=i.add(g,e,h);if(b.e&&Array.isArray(b.e.i))e.inX=
b.e.i[0],e.inY=b.e.i[1];if(b.e&&Array.isArray(b.e.o))e.outX=b.e.o[0],e.outY=b.e.o[1];if(l&&b.t){if(Array.isArray(b.t.i))e.inTangent=new k(b.t.i[0],b.t.i[1],b.t.i[2]);if(Array.isArray(b.t.o))e.outTangent=new k(b.t.o[0],b.t.o[1],b.t.o[2]);e.update=!0}}i&&c.add(i)}else null!=d.x&&null!=d.y?(this.setProp(g,"x",c,d.x),this.setProp(g,"y",c,d.y),null!=d.z&&this.setProp(g,"z",c,d.z),null!=d.w&&this.setProp(g,"w",c,d.w)):a[b]=d}}};var M=function(a){this.element=document.createElement("solid");this.model=a};
M.prototype={constructor:M,render:function(){var a=this.element.style,b=this.model;a.width=b.width;a.height=b.height;a.backgroundColor=b.color}};var N=function(a){this.model=a;this.element=document.createElement("text");this.text=document.createElement("p");this.element.appendChild(this.text);this.offsetY=this.oldY=this.oldX=0;this.oldModel={text:null,textClass:null,fontFamily:null,textColor:null,fontSize:null,lineHeight:null,letterSpacing:null,textAlign:null,verticalAlign:null,width:null,height:null}};
N.prototype={constructor:N,checkDifference:function(a,b){var c=!1,d,e,g;for(g in b)b.hasOwnProperty(g)&&(d=a[g],e=b[g],d!==e&&("object"!==typeof d||null===d)?(c=!0,b[g]=d):null!=d&&d.clone&&d.equals&&!d.equals(e)&&(c=!0,b[g]=d.clone()));return c},render:function(){var a=this.model,b=this.text.style,c=a.fontSize,d=a.height,e=c*a.leading-c,g=0;if(this.checkDifference(this.model,this.oldModel)){e=document.createTextNode(a.text);this.node?this.text.replaceChild(e,this.node):this.text.appendChild(e);this.node=
e;b.width=a.width+"px";b.color=a.textColor;b.textAlign=a.textAlign;b.fontFamily=a.fontFamily;b.fontSize=a.fontSize+"px";b.lineHeight=a.lineHeight+"em";for(e=c*a.lineHeight-c;6>=g&&this.text.offsetHeight-e>=d;)c*=0.92,e=c*a.lineHeight-c,b.fontSize=c+"px",g++;this.offsetY=a.textPosition.y-e/2;c=d-(this.text.offsetHeight-e/2);switch(a.verticalAlign){case "bottom":this.offsetY+=c;break;case "middle":this.offsetY+=c/2}}if(this.oldX!==a.textPosition.x)this.oldX=a.textPosition.x,b.left=this.oldX;if(this.oldY!==
this.offsetY)this.oldY=this.offsetY,b.top=this.oldY}};var K=function(a){var b=a.layers.on,c;this.model=a;this.element=document.createElement("composition");this.collapse=null;this.height=this.width=this.centerY=this.centerX=this.zoom=0;this.layers=[];var d=this;a.layers.each(function(a){if(c=d.generate(a))d.element.firstChild?d.element.insertBefore(c.element,d.element.firstChild):d.element.appendChild(c.element),d.layers.push(c)});b.add.add(this.add,this);b.remove.add(this.remove,this);b.swap.add(this.swap,
this);this.matrix_=new m;this.matrix2D_=new m;this.tempMatrix_=new m};K.prototype={constructor:K,add:function(a,b){var c=this.generate(a),d=thid.element,e;c&&(d.hasChildNodes()||0>b?(e=d.childNodes(),d.insertBefore(c.element,e[e.length-b-1])):d.appendChild(c.element),this.layers.splice(b,0,c))},remove:function(a,b){this.element.removeChild(this.layers[b].element);this.layers.splice(b,1)},swap:function(a,b){var c=this.layers[a];this.layers[a]=this.layers[b];this.layers[b]=c},generate:function(a){var b=
document.createElement("layer"),c={model:a,element:b,mask:null,scale:1,opacity:1},d=null;switch(a.type){case "composition":d=new K(a);break;case "text":d=new N(a);break;case "solid":d=new M(a)}if(d&&d.element)b.appendChild(d.element),c.content=d.element,c.handler=d;return c},render:function(a,b,c){var d=this.layers,e=this.layers.length,g=this.model,h=this.element.style,a=a?a:g.getCamera(),i=a.getCameraMatrix(),f,j,l;if(this.collapse!==g.collapse&&(this.collapse=g.collapse,this.setCollapse(),!this.collapse))this.width=
this.height=this.zoom=null;if(!this.collapse){if(this.width!==g.width||this.heigh!==g.height)this.width=g.width,this.height=g.height,h.width=this.width.toString()+"px",h.height=this.height.toString()+"px",h.clip="rect(0px , "+this.width+"px, "+this.height+"px, 0px)";if(p.have3DTransform){if(this.zoom!==a.zoom)this.zoom=a.zoom,h[p.PERSPECTIVE]=this.zoom.toString()+"px";if(this.centerX!==a.center.x||this.centerY!==a.center.y)this.centerX=a.center.x,this.centerY=a.center.y,h[p.ORIGIN]=this.centerX.toString()+
"px "+this.centerY.toString()+"px"}}for(g=0;g<e;g++){f=d[g];if(f.visible!==f.model.visible)f.visible=f.model.visible,h.display=f.visible?"block":"none";if(f.visible&&f.handler&&f.content){j=this.matrix_.injectMatrix(f.model.getMatrix());b&&f.model.is3D?j.multiply(b):c&&!f.model.is3D&&j.multiply(c);if("composition"===f.model.type&&f.model.collapse){if(!f.collapse)f.collapse=!0,this.cleanTransform(f.element);l=j;f.model.is3D&&(l=this.matrix2D_.injectMatrix(f.model.getMatrix2D()),c&&l.multiply(c));f.handler.render(a,
j,l)}else if(f.handler&&f.content){f.model.is3D&&j.multiply(i);if(f.model.collapse||!f.model.is3D){l=j.m21;var k=j.m22,m=j.m23;l=1.2*(f.model.is3D?Math.sqrt(l*l+k*k+m*m)*(this.zoom/(this.zoom-j.m43)):Math.sqrt(l*l+k*k));k=l/f.scale;if(1.3<k||0.77>k)f.scale=0.77<l&&1.1>l?1:l,this.setScale(f.content,l);l=1/f.scale;j.preMultiply(this.tempMatrix_.scaling(l,l,1))}else if(!f.model.collapse&&f.model.is3D&&1!==f.scale)f.scale=1,this.setScale(f.content,f.scale);f.collapse=f.model.collapse;f.handler.render();
this.setMatrix(f.element,j,f.model.is3D?a:null)}if(f.opacity!==f.model.opacity)f.opacity=f.model.opacity,this.setOpacity(f.element,f.model.opacity);j.identity()}}},setCollapse:function(){var a=this.element.style;this.collapse?(a[p.TRANSFORM_STYLE]="",a[p.PERSPECTIVE]="",a[p.PERSPECTIVE_ORIGIN]="",a.clip="",a.overflow=""):(a.overflow="hidden",a[p.TRANSFORM_STYLE]="flat")},setScale:function(a,b){a.style[p.TRANSFORM]=1!==b?"scale("+b.toFixed(4)+","+b.toFixed(4)+")":""},setMatrix:function(a,b,c){if(p.have3DTransform)a.style[p.TRANSFORM]=
b.toCSS();else{var d=b.m11,e=b.m12,g=b.m21,h=b.m22,i=b.m41,f=b.m42,b=b.m43;c&&(b=c.zoom/(c.zoom-b),d*=b,e*=b,g*=b,h*=b,i=i*b+c.center.x*(1-b),f=f*b+c.center.y*(1-b));p.haveTransform?a.style[p.TRANSFORM]="matrix("+d.toFixed(4)+","+e.toFixed(4)+","+g.toFixed(4)+","+h.toFixed(4)+","+i.toFixed(4)+","+f.toFixed(4)+")":(a.style.left=i+"px",a.style.top=f+"px")}},cleanTransform:function(a){a.style[p.TRANSFORM]=""},setOpacity:function(a,b){a.style.opacity=1!==b?b:""}};var R=function(a,b){this.scene=new K(a);
this.camera=b;this.element=document.createElement("scene");this.element.appendChild(this.scene.element);if(!document.getElementById("AEStyleSheet")){var c=document.createElement("style");c.id="AEStyleSheet";c.type="text/css";c.rel="stylesheet";c.media="screen";c.title="AEStyleSheet";c.styleSheet?(console.log(c.styleSheet.cssText),c.styleSheet.cssText="scene * {position:absolute;display:block;top:0px;left:0px;margin:0px;padding:0px;border:0px;word-wrap:break-word;-webkit-font-smoothing:antialiased;transform-origin:0% 0%;-o-transform-origin:0% 0%;-khtml-transform-origin:0% 0%;-moz-transform-origin:0% 0%;-webkit-transform-origin:0% 0%;-ms-transform-origin:0% 0%;}"):
(console.log("cssNode.styleSheet.cssText"),c.innerHTML="scene * {position:absolute;display:block;top:0px;left:0px;margin:0px;padding:0px;border:0px;word-wrap:break-word;-webkit-font-smoothing:antialiased;transform-origin:0% 0%;-o-transform-origin:0% 0%;-khtml-transform-origin:0% 0%;-moz-transform-origin:0% 0%;-webkit-transform-origin:0% 0%;-ms-transform-origin:0% 0%;}");document.getElementsByTagName("head")[0].appendChild(c)}if(a.color)this.scene.element.style.backgroundColor=a.color};R.prototype.render=
function(){this.scene.render()};n.DomRenderer=R;"function"===typeof define&&define.amd?define("AE",[],n):"undefined"!==typeof module&&module.exports?module.exports=n:S.AE=n})(this);