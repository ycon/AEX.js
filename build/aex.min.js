(function(){var requirejs,require,define;(function(a){function g(a,b){if(a&&a.charAt(0)==="."&&b){b=b.split("/"),b=b.slice(0,b.length-1),a=b.concat(a.split("/"));var c,d;for(c=0;d=a[c];c++)if(d===".")a.splice(c,1),c-=1;else if(d===".."){if(c===1&&(a[2]===".."||a[0]===".."))break;c>0&&(a.splice(c-1,2),c-=2)}a=a.join("/")}return a}function h(b,c){return function(){return f.apply(a,d.call(arguments,0).concat([b,c]))}}function i(a){return function(b){return g(b,a)}}function j(a){return function(c){b[a]=c}}function k(d){if(c.hasOwnProperty(d)){var f=c[d];delete c[d],e.apply(a,f)}return b[d]}function l(a,b){var c,d,e=a.indexOf("!");return e!==-1?(c=g(a.slice(0,e),b),a=a.slice(e+1),d=k(c),d&&d.normalize?a=d.normalize(a,i(b)):a=g(a,b)):a=g(a,b),{f:c?c+"!"+a:a,n:a,p:d}}var b={},c={},d=[].slice,e,f;if(typeof define=="function")return;e=function(d,e,f,g){var i=[],m,n,o,p,q,r;g||(g=d);if(typeof f=="function"){!e.length&&f.length&&(e=["require","exports","module"]);for(p=0;p<e.length;p++){r=l(e[p],g),o=r.f;if(o==="require")i[p]=h(d);else if(o==="exports")i[p]=b[d]={},m=!0;else if(o==="module")n=i[p]={id:d,uri:"",exports:b[d]};else if(b.hasOwnProperty(o)||c.hasOwnProperty(o))i[p]=k(o);else{if(!r.p)throw d+" missing "+o;r.p.load(r.n,h(g,!0),j(o),{}),i[p]=b[o]}}q=f.apply(b[d],i),d&&(n&&n.exports!==a?b[d]=n.exports:m||(b[d]=q))}else d&&(b[d]=f)},requirejs=f=function(b,c,d,g){return typeof b=="string"?k(l(b,c).f):(b.splice||(c.splice?(b=c,c=arguments[2]):b=[]),g?e(a,b,c,d):setTimeout(function(){e(a,b,c,d)},15),f)},f.config=function(){return f},require||(require=f),define=function(a,b,d){b.splice||(d=b,b=[]),define.unordered?c[a]=[a,b,d]:e(a,b,d)},define.amd={jQuery:!0}})(),define("extern/almond",function(){}),define("extern/ES5",[],function(){function d(a){return a=+a,a!==a?a=0:a!==0&&a!==1/0&&a!==-Infinity&&(a=(a>0||-1)*Math.floor(Math.abs(a))),a}var a=Array.prototype,b=Object.prototype,c=a.slice;return Function.prototype.bind||(Function.prototype.bind=function(b){var d=this;if(typeof d!="function")throw new TypeError("Function.prototype.bind called on incompatible "+d);var e=c.call(arguments,1),f=function(){if(this instanceof f){var a=function(){};a.prototype=d.prototype;var g=new a,h=d.apply(g,e.concat(c.call(arguments)));return Object(h)===h?h:g}return d.apply(b,e.concat(c.call(arguments)))};return f}),Array.isArray||(Array.isArray=function(b){return Object.prototype.toString.call(b)==="[object Array]"}),Array.prototype.indexOf||(Array.prototype.indexOf=function(b){var c=this,e,f="a"[0]!="a";f&&typeof o=="string"&&o&&(c=c.split("")),c=Object(this),e=c.length>>>0;if(!e)return-1;var g=0;arguments.length>1&&(g=d(arguments[1])),g=g>=0?g:Math.max(0,e+g);for(;g<e;g+=1)if(g in c&&c[g]===b)return g;return-1}),{done:!0}}),define("geom/Vector",[],function(){function a(a,b,c){this.x=a||0,this.y=b||0,this.z=c||0}return a.isVector=function(a){return a&&typeof a.x=="number"&&typeof a.y=="number"},a.prototype={constructor:a,set:function(a,b,c){return this.x=a,this.y=b,this.z=c,this},setX:function(a){return this.x=a,this},setY:function(a){return this.y=a,this},setZ:function(a){return this.z=a,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z||0,this},clone:function(){return new a(this.x,this.y,this.z)},add:function(a){return this.x+=a.x,this.y+=a.y,this.z+=a.z,this},addScalar:function(a){return this.x+=a,this.y+=a,this.z+=a,this},sub:function(a){return this.x-=a.x,this.y-=a.y,this.z-=a.z,this},multiply:function(a){return this.x*=a.x,this.y*=a.y,this.z*=a.z,this},multiplyScalar:function(a){return this.x*=a,this.y*=a,this.z*=a,this},divide:function(a){return this.x/=a.x,this.y/=a.y,this.z/=a.z,this},divideScalar:function(a){return a?(this.x/=a,this.y/=a,this.z/=a):(this.x=0,this.y=0,this.z=0),this},dot:function(a){return this.x*a.x+this.y*a.y+this.z*a.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lerp:function(a,b){return this.x+=(a.x-this.x)*b,this.y+=(a.y-this.y)*b,this.z+=(a.z-this.z)*b,this},cross:function(a){var b=this.x,c=this.y,d=this.z;return this.x=c*a.z-d*a.y,this.y=d*a.x-b*a.z,this.z=b*a.y-c*a.x,this},flatten:function(a,b){var c=a/(a-this.z);return this.x=this.x*c+b.x*(1-c),this.y=this.y*c+b.y*(1-c),this},multiplyMatrix:function(a){return a.multiplyVector(this),this},distance:function(a){return Math.sqrt(this.distanceSq(a))},distanceSq:function(a){return this.clone().sub(a).lengthSq()},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z},isZero:function(){return this.lengthSq()<1e-4},max:function(){return Math.max(this.x,Math.max(this.y,this.z))},min:function(a){return Math.min(this.x,Math.min(this.y,this.z))},setFromQuaternion:function(a){this.x=Math.atan2(2*(a.x*a.w-a.y*a.z),a.w*a.w-a.x*a.x-a.y*a.y+a.z*a.z),this.y=Math.asin(2*(a.x*a.z+a.y*a.w)),this.z=Math.atan2(2*(a.z*a.w-a.x*a.y),a.w*a.w+a.x*a.x-a.y*a.y-a.z*a.z)}},a}),define("geom/Quaternion",[],function(){function b(a,b,c,d){this.x=a||0,this.y=b||0,this.z=c||0,this.w=d||1}var a;return b.isQuaternion=function(a){var b="number";return a&&typeof a.x===b&&typeof a.y===b&&typeof a.w===b},b.prototype={constructor:b,set:function(a,b,c,d){return this.x=a,this.y=b,this.z=c||0,this.w=!d&&d!==0?1:d,this},copy:function(a){return this.x=a.x,this.y=a.y,this.z=a.z||0,this.w=a.w||1,this},clone:function(){return new b(this.x,this.y,this.z,this.w)},equals:function(a){return a.x===this.x&&a.y===this.y&&a.z===this.z&&a.w===this.w},multiply:function(a){var b=this.x,c=this.y,d=this.z,e=this.w;return this.w=e*a.w-b*a.x-c*a.y-d*a.z,this.x=e*a.x+b*a.w+c*a.z-d*a.y,this.y=e*a.y+c*a.w+d*a.x-b*a.z,this.z=e*a.z+d*a.w+b*a.y-c*a.x,this},setFromEuler:function(b){var c=Math.sin,d=Math.cos,e=Math.PI/360,f=b.x*e,g=b.y*e,h=b.z*e,i=d(g),j=c(g),k=d(-h),l=c(-h),m=d(f),n=c(f);return this.set(0,0,l,k).multiply(a.set(0,j,0,i)).multiply(a.set(n,0,0,m)),this},divideScalar:function(a){return a?(this.x/=a,this.y/=a,this.z/=a,this.w/=a):(this.x=0,this.y=0,this.z=0,this.w=0),this},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.lengthSq())},normalize:function(){return this.divideScalar(this.length())},lerp:function(a,b){var c=this.x,d=this.y,e=this.z,f=this.w,g=f*a.w+c*a.x+d*a.y+e*a.z,h,i,j,k;return g<0?(this.set(-a.x,-a.y,-a.z,-a.w),g=-g):this.copy(a),h=Math.acos(g),i=Math.sqrt(1-g*g),Math.abs(i)<.001?(this.set(.5*(c+a.x),.5*(d+a.y),.5*(e+a.z),.5*(f+a.w)),this):(j=Math.sin((1-b)*h)/i,k=Math.sin(b*h)/i,this.set(c*j+this.x*k,d*j+this.y*k,e*j+this.z*k,f*j+this.w*k),this)},toJSON:function(){return{x:this.x,y:this.y,z:this.z,w:this.w}}},a=new b,b}),define("animation/KeyFrame",[],function(){function a(a,b,c){this.offset=a,this.position_=0,this.value=b,this.isHold=c,this.inX=0,this.inY=0,this.outX=0,this.outY=0,this.inTangent=null,this.outTangent=null,this.path=null,this.update=!1}return a}),function(a){function c(a,b,c,d,e){this._listener=b,this._isOnce=c,this.context=d,this._signal=a,this._priority=e||0}function d(a,b){if(typeof a!="function")throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",b))}var b={VERSION:"0.7.4"};c.prototype={active:!0,params:null,execute:function(a){var b,c;return this.active&&!!this._listener&&(c=this.params?this.params.concat(a):a,b=this._listener.apply(this.context,c),this._isOnce&&this.detach()),b},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},getListener:function(){return this._listener},_destroy:function(){delete this._signal,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"}},b.Signal=function(){this._bindings=[],this._prevParams=null},b.Signal.prototype={memorize:!1,_shouldPropagate:!0,active:!0,_registerListener:function(a,b,d,e){var f=this._indexOfListener(a,d),g;if(f!==-1){g=this._bindings[f];if(g.isOnce()!==b)throw new Error("You cannot add"+(b?"":"Once")+"() then add"+(b?"Once":"")+"() the same listener without removing the relationship first.")}else g=new c(this,a,b,d,e),this._addBinding(g);return this.memorize&&this._prevParams&&g.execute(this._prevParams),g},_addBinding:function(a){var b=this._bindings.length;do--b;while(this._bindings[b]&&a._priority<=this._bindings[b]._priority);this._bindings.splice(b+1,0,a)},_indexOfListener:function(a,b){var c=this._bindings.length,d;while(c--){d=this._bindings[c];if(d._listener===a&&d.context===b)return c}return-1},has:function(a,b){return this._indexOfListener(a,b)!==-1},add:function(a,b,c){return d(a,"add"),this._registerListener(a,!1,b,c)},addOnce:function(a,b,c){return d(a,"addOnce"),this._registerListener(a,!0,b,c)},remove:function(a,b){d(a,"remove");var c=this._indexOfListener(a,b);return c!==-1&&(this._bindings[c]._destroy(),this._bindings.splice(c,1)),a},removeAll:function(){var a=this._bindings.length;while(a--)this._bindings[a]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(a){if(!this.active)return;var b=Array.prototype.slice.call(arguments),c=this._bindings.length,d;this.memorize&&(this._prevParams=b);if(!c)return;d=this._bindings.slice(),this._shouldPropagate=!0;do c--;while(d[c]&&this._shouldPropagate&&d[c].execute(b)!==!1)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll(),delete this._bindings,delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}},typeof define=="function"&&define.amd?define("extern/signals",b):typeof module!="undefined"&&module.exports?module.exports=b:a.signals=b}(this),define("core/Stack",["extern/signals"],function(a){function b(a,b){this.on.add.dispatch(a,b,this)}function c(a){if(!(a instanceof this.type_))throw"not the right type"}function d(b){this.items_=[],this.type_=Object,b&&b.prototype instanceof this.type_&&(this.type_=b),this.on={add:new a.Signal,remove:new a.Signal,swap:new a.Signal}}return d.prototype={constructor:d,items_:null,type_:null,index:function(a){return this.items_.indexOf(a)},have:function(a){return this.index(a)!==-1},get:function(a){return this.items_[a]},getLength:function(){return this.items_.length},add:function(a){c.call(this,a);if(!!this.have(a))throw"item already present";this.items_.push(a),b.call(this,a,this.length-1)},insert:function(a,d){c.call(this,a);var e=this.items_;if(!!this.have(a))throw"item already present";var f=e.length;d<f?e.splice(d,0,a):e.push(a),b.call(this,a,Math.max(d,this.length-1))},remove:function(a){var b=this.items_,c=b.indexOf(a);if(c===-1)throw"item not present";b.splice(c,1),this.on.remove.dispatch(a,c,this)},swap:function(a,b){var c=this.items_,d=c.indexOf(a),e=c.indexOf(b);if(d===-1||e===-1)throw"one of the items not present";c[d]=b,c[e]=a,this.on.swap.dispatch(d,e,this)},each:function(a){var b=this.items_,c=b.length,d=0;for(;d<c;d+=1)a(b[d])}},d}),define("animation/AnimatorStack",["core/Stack"],function(a){function b(b){a.call(this),this.item=b,this.duration=1,this.frameRate=25,this.clamp=!1}return b.prototype=new a,b.prototype.constructor=b,b.prototype.animate=function(a){var b=this.items_,c=b.length,d=0;a%=this.duration,this.clamp&&(a=Math.floor(a*this.frameRate)/this.frameRate);if(a!==this.prevTime_){for(;d<c;d+=1)b[d].animate(a);this.prevTime_=a}},b}),define("geom/bezierEase",[],function(){function a(a,c,d,e,f,g){c=c||0,e=e||0;var h=b(a||0,d||0,f||0,g),i=c*3,j=3*(e-c)-i,k=1-i-j;return((k*h+j)*h+i)*h}function b(a,b,d,e){var f=3*a,g=3*(b-a)-f,h=1-f-g,i=g*2,j=h*3,k,l,m,n,o,p;e||(e=1e-4),m=d;for(p=0;p<8;p+=1){n=((h*m+g)*m+f)*m-d;if(c(n)<e)return m;o=(j*m+i)*m+f;if(c(o)<1e-6)break;m-=n/o}k=0,l=1,m=d;if(m<k)return k;if(m>l)return l;p=0;while(k<l&&p<10){n=((h*m+g)*m+f)*m;if(c(n-d)<e)return m;d>n?k=m:l=m,m=(l-k)*.5+k,p+=1}return m}function c(a){return a>=0?a:0-a}return a}),define("animation/Keys",["geom/bezierEase","./KeyFrame"],function(a,b){function c(a,b){this.target=a,this.property=b,this.keys_=[],this.length_=0}return c.prototype={constructor:c,length:function(){var a=this.keys_,b,c,d,e;if(this.update){d=a.length,e=0,c=0;for(;c<d;c+=1)b=a[c],e+=b.offset,b.position_=e,b.update&&b.path&&(b.inTangent||b.outTangent)&&(this.path=null,b.update=!1);this.length_=e,this.update=!1}return this.length_},num:function(){return this.keys_.length},indexAt:function(a){var b=this.keys_,c=this.prevIndex_||0,d=a>=(this.prevPosition_||0)?1:-1;this.length(),this.prevPosition_=a;if(a<=b[0].position_)return this.prevIndex_=0,this.prevIndex_;if(a>=b[b.length-1].position_)return this.prevIndex_=b.length-1,this.prevIndex_;while(b[c]){if(a>=b[c].position_&&(!b[c+1]||a<b[c+1].position_))return this.prevIndex_=c,this.prevPosition_=a,this.prevIndex_;c+=d}return this.prevIndex_=0,this.prevIndex_},get:function(b,c){var d=this.indexAt(b),e=this.keys_[d],f,g;if(d===0&&b<=e.offset||d>=this.num()-1||e.isHold)return e.value;f=this.keys_[d+1],g=(b-e.position_)/f.offset;if(e.outX||e.outY||f.inX||f.inY)g=a(e.outX,e.outY,f.inX,f.inY,g);return this.interpolate(e,f,g,c)},interpolate:function(a,b,c){return a.value+(b.value-a.value)*c},set:function(a){var b=this.get(a);this.target[this.property]!==b&&(this.target[this.property]=b)},add:function(a,c,d){var e=new b(a,c,d);return this.length_+=a,e.position_=this.length_,this.keys_.push(e),e}},c}),define("animation/Animator",["core/Stack","./Keys"],function(a,b){function c(c,d,e,f){a.call(this),this.layer=c,this.inPoint=d||0,this.outPoint=e||1/0,this.source=f,this.startTime=0,this.speed=1,this.remap=new b}return c.prototype=new a,c.prototype.constructor=c,c.prototype.animate=function(a){var b=this.layer,c=this.items_,d=0,e;if(a>=this.inPoint&&a<=this.outPoint){b.visible=!0,e=c.length;for(;d<e;d+=1)c[d].set(a);this.source&&(this.remap.num()?this.source.animate(this.remap.get(a-this.startTime)):this.source.animate((a-this.startTime)*this.speed))}else b.visible=!1},c}),define("path/Line",[],function(){function a(a,b){this.start=a,this.end=b,this.update=!0}return a.prototype={constructor:a,length:function(){return this.update&&(this.length_=this.start.distance(this.end),this.update=!1),this.length_},getVect:function(a,b){return(b?b.copy(this.start):this.start.clone()).lerp(this.end,a)}},a}),define("path/QuadCurve",[],function(){function a(a,b,c,d){var e=.5*(b-a),f=.5*(a+b),g=d.clone(),h;return h=g.multiplyScalar(2*(f+e*-0.8611363116)).add(c).lengthSq()*.3478548451,h+=g.copy(d).multiplyScalar(2*(f+e*.8611363116)).add(c).lengthSq()*.3478548451,h+=g.copy(d).multiplyScalar(2*(f+e*-0.3399810436)).add(c).lengthSq()*.6521451549,h+=g.copy(d).multiplyScalar(2*(f+e*.3399810436)).add(c).lengthSq()*.6521451549,h}function b(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h,i,j,k;return a>=e?(h=(a-e)/(1-e),j=g,k=.75):a>=d?(h=(a-d)/(e-d),k=.5,j=g):a>=c?(h=(a-c)/(d-c),k=.25,j=f):(h=a/c,k=0,j=f),i=2*(1-h)*h,(i*j+h*h)*.25+k}function c(a,b,c){this.start=a,this.anchor=b,this.end=c,this.temp_=this.start.clone(),this.update=!0}return c.prototype={constructor:c,length:function(){if(this.update){this.update=!1;var b=this.anchor.clone().sub(this.start).multiplyScalar(2),c=this.start.clone().sub(this.anchor.clone().multiplyScalar(2)).add(this.end),d=Math.sqrt,e=5.65685425,f,g,h,i,j,k;g=d(a(0,.25,b,c))/e,h=d(a(.25,.5,b,c))/e,i=d(a(.5,.75,b,c))/e,f=g+h+i+d(a(.75,1,b,c))/e,i=(g+h+i)/f,h=(g+h)/f,g/=f,j=.5+(1-g/(h-g))/4,k=.5-(1-(1-i)/(i-h))/5,this.length_=f,this.inverse_=[g,h,i,j,k]}return this.length_},getVect:function(a,c){this.length();var d=b(a,this.inverse_),e=c?c.copy(this.start):this.start.clone();return e.lerp(this.anchor,d).lerp(this.temp_.copy(this.anchor).lerp(this.end,d),d)}},c}),define("path/SimplePath",["./Line","./QuadCurve"],function(a,b){function c(a){this.start=a||0,this.elements=[],this.update=!0}return c.prototype={constructor:c,length:function(){if(this.update){var a=0,b=this.elements.length,c=0;this.update=!1,this.lengths_=[a];for(;c<b;c+=1)a+=this.elements[c].length(),this.lengths_.push(a);this.lastPos_=0,this.lastItemPos_=0,this.length_=a}return this.length_},getItem:function(a){a*=this.length();var b=a>=this.lastPos_?1:-1,c=this.elements.length,d,e;for(var f=this.lastItemPos_;f<c;f+=b){d=this.lengths_[f],e=this.elements[f];if(a>=d&&a<d+e.length())return this.lastItemPos_=f,this.lastPos_=d,e}},getVect:function(a,b){var c=this.getItem(a);return a*=this.length(),c?c.getVect((a-this.lastPos_)/c.length(),b):b?b.copy(this.start):this.start.clone()},lineTo:function(b){this.elements.push(new a(this.start,b)),this.start=b,this.update=!0},curveTo:function(a,c){this.elements.push(new b(this.start,a,c)),this.start=c,this.update=!0}},c}),define("geom/cubicToQuadratic",[],function(){function a(b,c,d,e,f,g){var h=b.clone(),i=e.clone();if(d.equals(e))return f.curveTo(h.lerp(c,.89),e),f;if(c.equals(b))return f.curveTo(i.lerp(d,.89),e),f;h.lerp(c,1.5),i.lerp(d,1.5),g||(g=(Math.max(Math.max(h.max(),i.max()),Math.max(b.max(),e.max()))-Math.min(Math.min(h.min(),i.min()),Math.min(b.min(),e.min())))/350);var j=Math.sqrt(10.3923048/h.distance(i)*g);if(j>1)f.curveTo(h.lerp(i,.5),e);else{var k=b.clone(),l=k.clone().lerp(c,j),m=e,n=d.clone().lerp(e,j),o=c.clone().lerp(d,j),p=l.clone().lerp(o,j),q=o.lerp(n,j),r=p.clone().lerp(q,j);h=k.clone().lerp(l,1.5),i.copy(r).lerp(p,1.5),f.curveTo(h.lerp(i,.5),r.clone()),j<.5&&(j=1-j/(1-j),c=q.clone(),d=n.clone(),b=k.copy(r),l.copy(k).lerp(c,j),n.copy(d).lerp(e,j),o.copy(c).lerp(d,j),p.copy(l).lerp(o,j),q=o.lerp(n,j),r.copy(p).lerp(q,j),a(k,l,p.clone(),r.clone(),f,g)),h=r.clone().lerp(q,1.5),i=m.clone().lerp(n,1.5),f.curveTo(h.lerp(i,.5),e.clone())}return f}return a}),define("path/CubicCurve",["./SimplePath","geom/cubicToQuadratic"],function(a,b){function c(a,b,c,d){this.start=a,this.a1=b,this.a2=c,this.end=d,this.update=!0}return c.prototype={constructor:c,length:function(){return this.update&&(this.update=!1,this.path=b(this.start,this.a1,this.a2,this.end,new a(this.start)),this.length_=this.path.length()),this.length_},getVect:function(a,b){return this.length(),this.path.getVect(a,b)}},c}),define("animation/SpatialKeys",["./Keys","path/CubicCurve"],function(a,b){function c(b,c){a.call(this,b,c),this.temp_=b[c].clone()}return c.prototype=new a,c.prototype.constructor=c,c.prototype.interpolate=function(a,c,d,e){return a.update&&(a.outTangent&&c.inTangent?a.path=new b(a.value,a.outTangent.clone().add(a.value),c.inTangent.clone().add(c.value),c.value):a.path=null,a.update=!1),a.path?a.path.getVect(d,e):(e?e.copy(a.value):a.value.clone()).lerp(c.value,d)},c.prototype.set=function(a){var b=this.get(a,this._temp),c=this.target[this.property];c.equals&&!c.equals(b)&&c.copy(b)},c}),define("animation",["animation/KeyFrame","animation/Animator","animation/AnimatorStack","animation/Keys","animation/SpatialKeys"],function(a,b,c,d,e){return{KeyFrame:a,Animator:b,AnimatorStack:c,Keys:d,SpatialKeys:e}}),define("geom/Matrix",["./Vector"],function(a){function f(){arguments.length&&this.injectArray(arguments)}var b=new a,c=new a,d=new a,e;return f.prototype={constructor:f,m11:1,m12:0,m13:0,m14:0,m21:0,m22:1,m23:0,m24:0,m31:0,m32:0,m33:1,m34:0,m41:0,m42:0,m43:0,m44:1,set:function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){var q=this;return q.m11=a,q.m12=b,q.m13=c,q.m14=d,q.m21=e,q.m22=f,q.m23=g,q.m24=h,q.m31=i,q.m32=j,q.m33=k,q.m34=l,q.m41=m,q.m42=n,q.m43=o,q.m44=p,this},injectArray:function(a){return this.set.apply(this,a)},injectMatrix:function(a){var b=this;return b.m11=a.m11,b.m12=a.m12,b.m13=a.m13,b.m14=a.m14,b.m21=a.m21,b.m22=a.m22,b.m23=a.m23,b.m24=a.m24,b.m31=a.m31,b.m32=a.m32,b.m33=a.m33,b.m34=a.m34,b.m41=a.m41,b.m42=a.m42,b.m43=a.m43,b.m44=a.m44,b},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},translation:function(a,b,c){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,a||0,b||0,c||0,1),this},translate:function(a,b,c){return this.m41+=a||0,this.m42+=b||0,this.m43+=c||0,this},scaling:function(a,b,c){return this.set(a||0,0,0,0,0,b||0,0,0,0,0,c||0,0,0,0,0,1),this},scale:function(a,b,c){a=a||1e-6,b=b||1e-6,c=c||1e-6;if(a!==1||b!==1||c!==1)this.m11*=a,this.m21*=a,this.m31*=a,this.m41*=a,this.m12*=b,this.m22*=b,this.m32*=b,this.m42*=b,this.m13*=c,this.m23*=c,this.m33*=c,this.m43*=c;return this},rotation:function(a,b,c){var d=Math.PI/180,e=Math.cos,f=Math.sin,g,h,i,j,k,l,m,n,o,p;return this.identity(),a=(a||0)*d,b=(b||0)*d,c=(-c||0)*d,g=e(a),h=f(a),i=e(b),j=f(b),k=e(c),l=f(c),m=g*k,n=g*l,o=h*k,p=h*l,this.m11=i*k,this.m12=o*j-n,this.m13=m*j+p,this.m21=i*l,this.m22=p*j+m,this.m23=n*j-o,this.m31=-j,this.m32=h*i,this.m33=g*i,this.m41=this.m42=this.m43=0,this},rotate:function(a,b,c){return a||b||c?this.multiply(e.rotation(a,b,c)):this},quaternionRotation:function(a,b,c,d){var e=d*d,f=a*a,g=b*b,h=c*c,i=1/(f+g+h+e),j,k;return this.m11=(f-g-h+e)*i,this.m22=(-f+g-h+e)*i,this.m33=(-f-g+h+e)*i,j=a*b,k=c*d,this.m21=2*(j+k)*i,this.m12=2*(j-k)*i,j=a*c,k=b*d,this.m31=2*(j-k)*i,this.m13=2*(j+k)*i,j=b*c,k=a*d,this.m32=2*(j+k)*i,this.m23=2*(j-k)*i,this},quaternionRotate:function(a,b,c,d){return d=!d&&d!==0?1:d,this.multiply(e.quaternionRotation(a,b,c,d))},lookingAt:function(a,e,f){var g=b.set(0,1,0),h=c,i=d.set(-a,-e,f).normalize();return g.cross(i),h.copy(i).cross(g),g.normalize(),h.normalize(),this.set(g.x,g.y,g.z,0,h.x,h.y,h.z,0,i.x,i.y,i.z,0,0,0,0,1),this},lookAt:function(a,b,c){return a||b?this.multiply(e.lookingAt(a,b,c)):this},determinant:function(){return-this.m13*this.m22*this.m31+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m11*this.m23*this.m32-this.m12*this.m21*this.m33+this.m11*this.m22*this.m33},invert:function(){var a=this.m11,b=this.m12,c=this.m13,d=this.m21,e=this.m22,f=this.m23,g=this.m31,h=this.m32,i=this.m33,j=this.m41,k=this.m42,l=this.m43,m=1/this.determinant();return this.m11=(-f*h+e*i)*m,this.m12=(c*h-b*i)*m,this.m13=(-c*e+b*f)*m,this.m14=0,this.m21=(f*g-d*i)*m,this.m22=(-c*g+a*i)*m,this.m23=(c*d-a*f)*m,this.m24=0,this.m31=(-e*g+d*h)*m,this.m32=(b*g-a*h)*m,this.m33=(-b*d+a*e)*m,this.m34=0,this.m41=(f*h*j-e*i*j-f*g*k+d*i*k+e*g*l-d*h*l)*m,this.m42=(b*i*j-c*h*j+c*g*k-a*i*k-b*g*l+a*h*l)*m,this.m43=(c*e*j-b*f*j-c*d*k+a*f*k+b*d*l-a*e*l)*m,this.m44=1,this},createInvert:function(){return this.clone().invert()},clone:function(){return(new f).set(this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44)},join:function(a,b){var c=a.m11,d=a.m12,e=a.m13,f=a.m14,g=a.m21,h=a.m22,i=a.m23,j=a.m24,k=a.m31,l=a.m32,m=a.m33,n=a.m34,o=a.m41,p=a.m42,q=a.m43,r=a.m44,s=b.m11,t=b.m12,u=b.m13,v=b.m14,w=b.m21,x=b.m22,y=b.m23,z=b.m24,A=b.m31,B=b.m32,C=b.m33,D=b.m34,E=b.m41,F=b.m42,G=b.m43,H=b.m44;return this.m11=c*s+d*w+e*A+f*E,this.m12=c*t+d*x+e*B+f*F,this.m13=c*u+d*y+e*C+f*G,this.m14=c*v+d*z+e*D+f*H,this.m21=g*s+h*w+i*A+j*E,this.m22=g*t+h*x+i*B+j*F,this.m23=g*u+h*y+i*C+j*G,this.m24=g*v+h*z+i*D+j*H,this.m31=k*s+l*w+m*A+n*E,this.m32=k*t+l*x+m*B+n*F,this.m33=k*u+l*y+m*C+n*G,this.m34=k*v+l*z+m*D+n*H,this.m41=o*s+p*w+q*A+r*E,this.m42=o*t+p*x+q*B+r*F,this.m43=o*u+p*y+q*C+r*G,this.m44=o*v+p*z+q*D+r*H,this},multiply:function(a){return this.join(this,a)},preMultiply:function(a){return this.join(a,this)},multiplyVector:function(a){var b=a.x,c=a.y,d=a.z;return a.x=this.m11*b+this.m21*c+this.m31*d+this.m41,a.y=this.m12*b+this.m22*c+this.m32*d+this.m42,a.z=this.m13*b+this.m23*c+this.m33*d+this.m43,a},toCSS:function(){return"matrix3d("+this.m11.toFixed(4)+","+this.m12.toFixed(4)+","+this.m13.toFixed(4)+","+this.m14.toFixed(4)+","+this.m21.toFixed(4)+","+this.m22.toFixed(4)+","+this.m23.toFixed(4)+","+this.m24.toFixed(4)+","+this.m31.toFixed(4)+","+this.m32.toFixed(4)+","+this.m33.toFixed(4)+","+this.m34.toFixed(4)+","+this.m41.toFixed(4)+","+this.m42.toFixed(4)+","+this.m43.toFixed(4)+","+this.m44.toFixed(4)+")"},toArray:function(){return[this.m11,this.m12,this.m13,this.m14,this.m21,this.m22,this.m23,this.m24,this.m31,this.m32,this.m33,this.m34,this.m41,this.m42,this.m43,this.m44]}},e=new f,f}),define("graph/LayerBase",["../geom/Matrix"],function(a){function b(){this.is3D=!0,this.parent=null,this.visible=!0,this.name=null,this.type="null",this.matrix_=new a,this.matrix2D_=new a}return b.prototype={constructor:b,getMatrix:function(){if(!this.is3D)return this.getMatrix2D();var a=this.matrix_.injectMatrix(this.getLocalMatrix()),b=this.parent;return b&&b!==this&&a.multiply(b.getMatrix()),a},getMatrix2D:function(){var a=this.matrix2D_.injectMatrix(this.getLocalMatrix2D()),b=this.parent;return b&&a.multiply(b.getMatrix2D()),a},getLocalMatrix:function(){return new a},getLocalMatrix2D:function(){return new a}},b}),define("graph/Layer",["geom/Vector","geom/Quaternion","geom/Matrix","core/Stack","./LayerBase"],function(a,b,c,d,e){function f(){e.call(this),this.filters=new d,this.masks=new d,this.collapse=!1,this.position=new a,this.anchor=new a,this.scale=new a(1,1,1),this.rotation=new a,this.orientation=new b,this.opacity=1,this.type="null",this.localMatrix_=new c,this.localMatrix2D_=new c,this.depthPoint_=new a}return f.prototype=new e,f.prototype.constructor=f,f.prototype.getLocalMatrix=function(){var a=this.position,b=this.anchor,c=this.scale,d=this.rotation,e=this.orientation;return this.localMatrix_.translation(-b.x,-b.y,b.z).scale(c.x,c.y,c.z).rotate(d.x,d.y,d.z).quaternionRotate(e.x,e.y,e.z,e.w).translate(a.x,a.y,-a.z)},f.prototype.getLocalMatrix2D=function(){var a=this.position,b=this.anchor,c=this.scale;return this.localMatrix2D_.translation(-b.x,-b.y,0).scale(c.x,c.y,1).rotate(0,0,this.rotation.z).translate(a.x,a.y,0)},f.prototype.getDepthPoint=function(){return this.depthPoint_.set(Math.max(Math.min(this.width||1024,this.anchor.x),0),Math.max(Math.min(this.height||768,this.anchor.y),0),0)},f}),define("graph/Solid",["./Layer"],function(a){function b(){a.call(this),this.color="#000000",this.width=640,this.height=360,this.type="solid"}return b.prototype=new a,b.prototype.constructor=b,b}),define("graph/Text",["geom/Vector","./Layer"],function(a,b){function c(){b.call(this),this.text="",this.textPosition=new a,this.width=150,this.height=150,this.textClass=null,this.fontFamily="Arial",this.textColor="#888888",this.fontSize=18,this.lineHeight=1.2,this.letterSpacing=0,this.textAlign="left",this.verticalAlign="top",this.collapse=!0,this.type="text"}return c.prototype=new b,c.prototype.constructor=c,c.prototype.getDepthPoint=function(){var a=this.textPosition.x,b=this.textPosition.y;return this.textAlign==="center"?a+=this.width*.5:this.textAlign==="right"&&(a+=this.width),this.verticalAlign==="middle"?b+=this.height*.5:this.verticalAlign==="bottom"&&(b+=this.height),this.depthPoint_.set(a,b)},c}),define("graph/Camera",["geom/Vector","geom/Quaternion","geom/Matrix","./LayerBase"],function(a,b,c,d){function e(){d.call(this),this.position=new a,this.rotation=new a,this.orientation=new b,this.target=new a,this.haveTarget=!0,this.zoom=1333.33,this.center=new a,this.is3D=!0,this.type="camera",this.localMatrix_=new c,this.localMatrix2D_=new c,this.matrixCamera_=new c,this.tMatCamera_=new c}return e.prototype=new d,e.prototype.constructor=e,e.prototype.getLocalMatrix=function(){var a=this,b=a.rotation,c=a.target,d=a.position,e=a.orientation,f=this.localMatrix_.rotation(b.x,b.y,b.z);return f.m41=f.m42=f.m43=0,f.quaternionRotate(e.x,e.y,e.z,e.w),a.haveTarget&&f.lookAt(c.x-d.x,c.y-d.y,c.z-d.z),f.translate(d.x,d.y,-d.z),f},e.prototype.getLocalMatrix2D=function(){return this.localMatrix2D_.rotation(0,0,this.rotation.z).translate(this.position.x,this.position.y,0)},e.prototype.getCameraMatrix=function(){var a=this.center;return this.matrixCamera_.translation(a.x,a.y,this.zoom).preMultiply(this.tMatCamera_.identity().injectMatrix(this.getMatrix()).invert())},e.prototype.align=function(a,b){this.center.x=this.position.x=a,this.center.y=this.position.y=b,this.position.z=-this.zoom},e}),define("graph/Composition",["core/Stack","./Layer","./Camera"],function(a,b,c){function d(){b.call(this);var d;this.layers=new a(b),this.cameras=new a(c),this.width=640,this.height=360,this.color="#000000",this.type="composition",d=new c,d.haveTarget=!1,d.align(this.width/2,this.height/2),this.defaultCam_=d}return d.prototype=new b,d.prototype.constructor=d,d.prototype.getCamera=function(){var a=0,b=this.cameras.getLength(),c;for(a=0;a<b;a+=1){c=this.cameras.get(a);if(c.visible)return c.center.set(this.width/2,this.height/2),c}return c=this.defaultCam_,c.align(this.width/2,this.height/2),c},d}),define("graph",["graph/Solid","graph/Text","graph/Camera","graph/Composition"],function(a,b,c,d){return{Solid:a,Text:b,Camera:c,Composition:d}}),define("builders/aeBuilder",["geom/Vector","geom/Quaternion","animation","graph"],function(a,b,c,d){function g(a){return j(a.items[a.root],a.items)}function h(a,b){var c=new d.Composition,f=new e(c),g=a.layers,h={},i={},j="",k=0,l,p;c.width=a.width,c.height=a.height,c.color=a.color||"#000000",f.duration=a.duration||1,f.frameRate=a.frameRate||25;for(;k<g.length;k+=1){l=g[k],p=null;switch(l.type){case"Camera":p=n(l),p.layer.center.set(c.width/2,c.height/2);break;case"Text":p=o(l);break;default:l.source&&(p=m(l,b))}p&&(l.parent!=null&&(h[l.parent]||(h[l.parent]=[]),h[l.parent].push(p.layer)),i[l.id]=p.layer,f.add(p),p.layer instanceof d.Camera?c.cameras.add(p.layer):c.layers.add(p.layer))}for(j in h)if(h.hasOwnProperty(j)&&Array.isArray(h[j])&&i.hasOwnProperty(j))for(k=0;k<h[j].length;k+=1)h[j][k].parent=i[j];return f}function i(a,b){var c=new d.Solid,f=new e(c);return c.width=a.width,c.height=a.height,c.color=a.color,f}function j(a,b){switch(a.type){case"Composition":return h(a,b);case"Solid":return i(a,b);case"Image":return k(a,b);case"Video":return l(a,b)}}function k(a,b){}function l(a,b){}function m(a,b){var c=j(b[a.source],b),d=c.item,e=new f(d,a.inPoint,a.outPoint);return p(e,a),e.source=c,e.startTime=a.startTime||0,e.speed=a.speed||1,e}function n(a){var b=new d.Camera,c=new f(b,a.inPoint,a.outPoint);return b.name=b.name,b.haveTarget=a.autoOrient!=="none"||a.autoOrient==="target",q(b,"position",c,a.position),q(b,"rotation",c,a.rotation),q(b,"orientation",c,a.orientation),q(b,"zoom",c,a.zoom),b.haveTarget&&q(b,"target",c,a.target),c}function o(a){var b=new d.Text,c=new f(b,a.inPoint,a.outPoint),e=["text","textPosition","width","height","textClass","fontFamily","textColor","fontSize","lineHeight","letterSpacing","textAlign","verticalAlign"],g=0,h=e.length;p(c,a);for(;g<h;g+=1)q(b,e[g],c,a[e[g]]);return c}function p(a,b){var c=a.layer;c.name=b.name,c.is3D=b.is3D||!1,b.collapse!=null&&(c.collapse=b.collapse===!0),q(c,"position",a,b.position),q(c,"anchor",a,b.anchor),q(c,"scale",a,b.scale),q(c,"opacity",a,b.opacity),c.is3D?(q(c,"rotation",a,b.rotation),q(c,"orientation",a,b.orientation)):q(c.rotation,"z",a,b.rotation)}function q(d,e,f,g){if(!g&&g!==0)return;var h,i,j,k,l,m,n,o,p,r,s,t=d[e];if(Array.isArray(g)){r=null,k=0,r=g.length&&Array.isArray(g[0])&&a.isVector(g[0][0])||a.isVector(g[0])||typeof g[0]=="object"&&a.isVector(g[0].v),m=r?new c.SpatialKeys(d,e):new c.Keys(d,e);for(h=0;h<g.length;h+=1)i=g[h],o=typeof i=="object",p=Array.isArray(i),l=p||!o||i.e&&i.e.o===0,j=p?i[0]:o&&i.v!=null?i.v:i,s=a.isVector(j),s&&(j.w!==undefined?j=new b(j.x,j.y,j.z,j.w):j=new a(j.x,j.y,j.z)),p?k=i[1]:o&&i.d!==undefined&&(k=i.d||0),n=m.add(k,j,l),i.e&&Array.isArray(i.e.i)&&(n.inX=i.e.i[0],n.inY=i.e.i[1]),i.e&&Array.isArray(i.e.o)&&(n.outX=i.e.o[0],n.outY=i.e.o[1]),r&&i.t&&(Array.isArray(i.t.i)&&(n.inTangent=new a(i.t.i[0],i.t.i[1],i.t.i[2])),Array.isArray(i.t.o)&&(n.outTangent=new a(i.t.o[0],i.t.o[1],i.t.o[2])),n.update=!0);m&&f.add(m)}else g.x!=null&&g.y!=null?(q(t,"x",f,g.x),q(t,"y",f,g.y),g.z!=null&&q(t,"z",f,g.z),g.w!=null&&q(t,"w",f,g.w)):d[e]=g}var e=c.AnimatorStack,f=c.Animator;return{build:g}}),define("geom/Matrix2D",["./Vector"],function(a){function f(){arguments.length&&this.injectArray(arguments)}var b=new a,c=new a,d=new a,e;return f.prototype={constructor:f,m11:1,m12:0,m21:0,m22:1,x:0,y:0,z:0,set:function(a,b,c,d,e,f,g){return this.m11=a,this.m12=b,this.m21=c,this.m22=d,this.x=e,this.y=f,this.z=g,this},injectArray:function(a){return this.set.apply(this,a)},injectMatrix:function(a){return this.m11=a.m11,this.m12=a.m12,this.m21=a.m21,this.m22=a.m22,this.x=a.x,this.y=a.y,this.z=a.z,this},identity:function(){return this.set(1,0,0,1,0,0,0),this},translation:function(a,b,c){return this.set(1,0,0,1,a||0,b||0,c||0,1),this},translate:function(a,b,c){return this.x+=a||0,this.y+=b||0,this.z+=c||0,this},preTranslate:function(a,b,c){return this.x+=a*this.m11+b*this.m21,this.y+=a*this.m12+b*this.m22,this.z+=c||0,this},scaling:function(a,b){return this.set(a||0,0,b||0,0,0,0),this},scale:function(a,b){a=a||1e-6,b=b||1e-6;if(a!==1||b!==1)this.m11*=a,this.m12*=a,this.x*=a,this.m21*=b,this.m22*=b,this.y*=b;return this},rotation:function(a){return this},rotate:function(a){return a?this.multiply(e.rotation(a)):this},clone:function(){return(new f).set(this.m11,this.m12,this.m21,this.m22,this.x,this.y,this.z)},join:function(a,b){var c=a.m11,d=a.m12,e=a.m21,f=a.m22,g=a.x,h=a.y,i=b.m11,j=b.m12,k=b.m21,l=b.m22,m=b.x,n=b.y;return this.m11=c*i+d*k,this.m12=c*j+d*l,this.m21=e*i+f*k,this.m22=e*j+f*l,this.x=g*i+h*k+m,this.y=g*j+h*l+n,this},multiply:function(a){return this.join(this,a)},preMultiply:function(a){return this.join(a,this)},multiplyVector:function(a){var b=a.x,c=a.y;return a.x=this.m11*b+this.m21*c+this.x,a.y=this.m12*b+this.m22*c+this.y,a},copy3D:function(a){return this.m11=a.m11,this.m12=a.m12,this.m21=a.m21,this.m22=a.m22,this.x=a.m41,this.y=a.m42,this},simulate3D:function(a,e,f,g){var h=b.copy(f).multiplyMatrix(a).flatten(g,e),i=c.set(f.x+1,f.y,0).multiplyMatrix(a).flatten(g,e).sub(h),j=d.set(f.x,f.y+1,0).multiplyMatrix(a).flatten(g,e).sub(h);return this.m11=i.x,this.m12=i.y,this.m21=j.x,this.m22=j.y,this.x=h.x-(f.x*this.m11+f.y*this.m21),this.y=h.y-(f.x*this.m12+f.y*this.m22),this},toCSS:function(){var a=this;return"matrix("+a.m11.toFixed(4)+","+a.m12.toFixed(4)+","+a.m21.toFixed(4)+","+a.m22.toFixed(4)+","+a.x.toFixed(4)+","+a.y.toFixed(4)+")"},toArray:function(){var a=this;return[a.m11,a.m12,a.m21,a.m22,a.x,a.y]}},e=new f,f}),define("renderers/dom/Solid",[],function(){function a(a){this.element=document.createElement("solid"),this.model=a}return a.prototype={constructor:a,render:function(){var a=this.element.style,b=this.model;a.width=b.width+"px",a.height=b.height+"px",a.backgroundColor=b.color}},a}),define("renderers/dom/Text",[],function(){function a(a,b){var c=!1,d,e;for(var f in b)b.hasOwnProperty(f)&&(d=a[f],e=b[f],d===e||typeof d=="object"&&d!==null?d!=null&&d.clone&&d.equals&&(d.equals(e)||(c=!0,b[f]=d.clone())):(c=!0,b[f]=d));return c}function b(a){this.model=a,this.element=document.createElement("text"),this.text=document.createElement("p"),this.element.appendChild(this.text),this.oldX=0,this.oldY=0,this.offsetY=0,this.oldModel={text:null,textClass:null,fontFamily:null,textColor:null,fontSize:null,lineHeight:null,letterSpacing:null,textAlign:null,verticalAlign:null,width:null,height:null}}return b.prototype={constructor:b,render:function(){var b=this.model,c=this.text.style,d=b.fontSize,e=6,f=b.height,g=d*b.leading-d,h=0,i;if(a(this.model,this.oldModel)){i=document.createTextNode(b.text),this.node?this.text.replaceChild(i,this.node):this.text.appendChild(i),this.node=i,c.width=b.width+"px",c.color=b.textColor,c.textAlign=b.textAlign,c.fontFamily=b.fontFamily,c.fontSize=b.fontSize+"px",c.lineHeight=b.lineHeight+"em",g=d*b.lineHeight-d;while(h<=e&&this.text.offsetHeight-g>=f)d*=.92,g=d*b.lineHeight-d,c.fontSize=d+"px",h+=1;this.offsetY=b.textPosition.y-g/2;var j=f-(this.text.offsetHeight-g/2);switch(b.verticalAlign){case"bottom":this.offsetY+=j;break;case"middle":this.offsetY+=j/2;break;default:}}this.oldX!==b.textPosition.x&&(this.oldX=b.textPosition.x,c.left=this.oldX),this.oldY!==this.offsetY&&(this.oldY=this.offsetY,c.top=this.oldY)}},b}),define("utils/browser",[],function(){function a(a){return a.charAt(0).toUpperCase()+a.substr(1)}function b(b){var d=[b],e=0,f=c.length;b=a(b);for(;e<f;e+=1)d.push(c[e]+b);return d}var c="Webkit Moz O ms Khtml".split(" "),d={TRANSFORM:"Transform",TRANSFORM_STYLE:"transformStyle",PERSPECTIVE:"perspective",ORIGIN:"perspectiveOrigin",getLocalBound:function(a,b){var c=0,d=0,e=0,f=0,g=a.childNodes,h=g.length,i=0,j=Math.min,k=Math.max,l=1,m,n,o,p,q;for(;i<h;i+=1){m=g[0];if(m.nodeType===1&&m.childNodes.length){l=parseFloat(m.style.zoom)||1,n=m.childNodes,p=n.length;for(q=0;q<p;q+=1)o=n[q],c=j(o.offsetLeft*l,c),e=j(o.offsetTop*l,e),d=k((o.offsetWidth+o.offsetLeft)*l,d),f=k((o.offsetHeight+o.offsetTop)*l,f)}else c=j(m.offsetLeft,c),e=j(m.offsetTop,e),d=k(m.offsetWidth+m.offsetLeft,d),f=k(m.offsetHeight+m.offsetTop,f)}return{x:c,y:e,width:d-c,height:f-e}}};return d.haveTransform=function(){var d=document.createElement("div"),e=b(this.TRANSFORM),f=0,g=e.length;if(d)for(;f<g;f+=1)if(f&&d.style[e[f]]!==undefined)return this.TRANSFORM=c[f-1]+a(this.TRANSFORM),!0;return!1}.call(d),d.have3DTransform=function(){var d=document.createElement("div"),e=b(this.PERSPECTIVE),f=0,g=e.length,h;if(d)for(;f<g;f+=1)if(f&&d.style[e[f]]!==undefined)return h=c[f-1],this.PERSPECTIVE=h+a(this.PERSPECTIVE),this.ORIGIN=h+a(this.ORIGIN),this.TRANSFORM_STYLE=h+a(this.TRANSFORM_STYLE),!0;return!1}.call(d),d.haveIEFilter=function(){var a=document.createElement("div");return a&&a.style.filter!==undefined?(a.style.width=a.style.height="100px",a.style.filter="progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand')",a.onfilterchange!==undefined):!1}.call(d),d}),define("renderers/dom/Composition",["geom/Matrix2D","geom/Matrix","utils/browser","./Solid","./Text"],function(a,b,c,d,e){function g(a,b){var c=j.call(this,a),d=this.element,e;c&&(d.hasChildNodes()||b<0?(e=d.childNodes(),d.insertBefore(c.element,e[e.length-b-1])):d.appendChild(c.element),this.layers.splice(b,0,c))}function h(a,b){var c=this.layers[b];this.element.removeChild(c.element),this.layers.splice(b,1)}function i(a,b){var c=this.layers[a];this.layers[a]=this.layers[b],this.layers[b]=c}function j(a){var b=document.createElement("layer"),f={model:a,element:b,mask:null,scale:1,opacity:1},g=null;switch(a.type){case"composition":g=new k(a);break;case"text":g=new e(a);break;case"solid":g=new d(a)}return g&&g.element&&(b.appendChild(g.element),f.content=g.element,f.handler=g),!c.haveTransform&&c.haveIEFilter&&(b.style.filter="progid:DXImageTransform.Microsoft.Matrix(M11='1.0', sizingMethod='auto expand'); progid:DXImageTransform.Microsoft.Alpha(Opacity=100)"),f}function k(a){var c=a.layers.on,d=this,e;this.model=a,this.element=document.createElement("composition"),this.collapse=null,this.zoom=0,this.centerX=0,this.centerY=0,this.width=0,this.height=0,this.layers=[],a.layers.each(function(a){e=j.call(d,a),e&&(d.element.firstChild?d.element.insertBefore(e.element,d.element.firstChild):d.element.appendChild(e.element),d.layers.push(e))}),c.add.add(g,this),c.remove.add(h,this),c.swap.add(i,this),this.matrix_=new b,this.matrix2D_=new b,this.tempMatrix_=new b}var f=new a;return k.prototype={constructor:k,render:function(a,b,d){var e=this.layers,f=this.layers.length,g=this.model,h=this.element.style,i=a?a:g.getCamera(),j=i.getCameraMatrix(),k=0;this.collapse!==g.collapse&&(this.collapse=g.collapse,this.setCollapse(),this.collapse||(this.width=this.height=this.zoom=null));if(this.width!==g.width||this.height!==g.height)this.width=g.width,this.height=g.height,h.width=this.width.toFixed(4)+"px",h.height=this.height.toFixed(4)+"px",this.collapse||(h.clip="rect(0px, "+this.width+"px, "+this.height+"px, 0px)");if(!this.collapse){this.zoom!==i.zoom&&(this.zoom=i.zoom,c.have3DTransform&&(h[c.PERSPECTIVE]=this.zoom.toString()+"px"));if(this.centerX!==i.center.x||this.centerY!==i.center.y)this.centerX=i.center.x,this.centerY=i.center.y,c.have3DTransform&&(h[c.ORIGIN]=this.centerX.toString()+"px "+this.centerY.toString()+"px")}for(;k<f;k+=1)this.renderLayer(e[k],i,j,b,d)},renderLayer:function(a,b,c,d,e){var f=a.model,g=a.element,h=a.handler,i=a.content,j=g.style,k=f.is3D,l,m;a.visible!==f.visible&&(a.visible=f.visible,j.display=a.visible?"block":"none");if(a.visible&&h&&i){l=this.matrix_.injectMatrix(f.getMatrix()),d&&k?l.multiply(d):e&&!k&&l.multiply(e);if(f.type==="composition"&&f.collapse)a.collapse||(a.collapse=!0,this.cleanTransform(g)),m=l,k&&(m=this.matrix2D_.injectMatrix(f.getMatrix2D()),e&&m.multiply(e)),h.render(b,l,m);else if(h&&i){k&&l.multiply(c);if(f.collapse){var n=l.m21,o=l.m22,p=l.m23,q=(k?Math.sqrt(n*n+o*o+p*p)*(this.zoom/(this.zoom-l.m43)):Math.sqrt(n*n+o*o))*1.2,r=q/a.scale;if(r>1.3||r<.77)a.scale=q>.77&&q<1.1?1:q,this.setScale(i,q);q=1/a.scale,l.preMultiply(this.tempMatrix_.scaling(q,q,1))}else!f.collapse&&k&&a.scale!==1&&(a.scale=1,this.setScale(i,a.scale));a.collapse=f.collapse,h.render(),this.setMatrix(g,l,f.is3D?b:null,f.getDepthPoint(),f.width,f.height)}a.opacity!==f.opacity&&(a.opacity=f.opacity,this.setOpacity(g,f.opacity)),l.identity()}},setCollapse:function(){var a=this.element.style;if(this.collapse){c.have3DTransform&&(a[c.TRANSFORM_STYLE]="",a[c.PERSPECTIVE]="",a[c.PERSPECTIVE_ORIGIN]="");try{a.clip=""}catch(b){a.clip="rect(auto ,auto, auto, auto)"}a.overflow=""}else a.overflow="hidden",a[c.TRANSFORM_STYLE]="flat"},setScale:function(a,b){c.haveTransform?a.style[c.TRANSFORM]=b!==1?"scale("+b.toFixed(4)+","+b.toFixed(4)+")":"":a.style.zoom!==undefined&&(a.style.zoom=b)},setMatrix:function(a,b,d,e){var g=a.style,h,i;if(c.have3DTransform)g[c.TRANSFORM]=b.toCSS();else{h=f,d?h.simulate3D(b,d.center,e,d.zoom):h.copy3D(b);if(c.haveTransform)g[c.TRANSFORM]=h.toCSS();else{if(c.haveIEFilter&&a.filters.length){var j=c.getLocalBound(a);g.width=j.width+"px",g.height=j.height+"px";if(j.x||j.y){var k=a.childNodes,l=k.length,m=0,n;for(;m<l;m+=1)n=k[m],n.style.left=-j.x+"px",n.style.top=-j.y+"px"}h.preTranslate(j.x,j.y),this.slideMatrixBounds(h,j),i=a.filters.item(0),i.M11=h.m11,i.M12=h.m21,i.M21=h.m12,i.M22=h.m22}g.left=h.x.toFixed(4)+"px",g.top=h.y.toFixed(4)+"px"}}},slideMatrixBounds:function(a,b){var c=Math.min;a.x+=c(0,c(b.width*a.m11+b.height*a.m21,c(b.width*a.m11,b.height*a.m21))),a.y+=c(0,c(b.width*a.m12+b.height*a.m22,c(b.width*a.m12,b.height*a.m22)))},cleanTransform:function(a){a.style[c.TRANSFORM]="",a.style.filter=""},setOpacity:function(a,b){a.style.opacity!==undefined?a.style.opacity=b!==1?b:"":c.haveIEFilter&&a.filters.length>=2&&(a.filters.item(1).Opacity=b*100)}},k}),define("renderers/dom/Renderer",["./Composition"],function(a){function b(b,c){this.scene=new a(b),this.camera=c,this.element=document.createElement("scene"),this.element.appendChild(this.scene.element);if(!document.getElementById("AEStyleSheet")){var d=document.createElement("style"),e="scene * {position:absolute;display:block;top:0px;left:0px;margin:0px;padding:0px;border:0px;word-wrap:break-word;-webkit-font-smoothing:antialiased;transform-origin:0% 0%;-o-transform-origin:0% 0%;-khtml-transform-origin:0% 0%;-moz-transform-origin:0% 0%;-webkit-transform-origin:0% 0%;-ms-transform-origin:0% 0%;}scene layer {-ms-filter: \"progid:DXImageTransform.Microsoft.Matrix(M11='2.0', sizingMethod='auto expand')\"}scene solid {position: absolute}";d.id="AEStyleSheet",d.type="text/css",d.rel="stylesheet",d.media="screen",d.title="AEStyleSheet",d.styleSheet?(d.styleSheet.cssText=e,console.log(d.styleSheet.cssText)):d.innerHTML=e,document.getElementsByTagName("head")[0].appendChild(d)}b.color&&(this.scene.element.style.backgroundColor=b.color)}return b.prototype.render=function(){this.scene.render()},b}),define("main",["extern/ES5","builders/aeBuilder","graph","renderers/dom/Renderer","utils/browser"],function(ES5,aeBuilder,graph,DomRenderer,browser){var global=function(){return this||(1,eval)("this")}(),exp=typeof exports!="undefined"?exports:{};return exp.build=aeBuilder.build,exp.Composition=graph.Composition,exp.Text=graph.Text,exp.Solid=graph.Solid,exp.Camera=graph.Camera,exp.DomRenderer=DomRenderer,exp.browser=browser,typeof global.define=="function"&&global.define.amd?define("aex",[],function(){return exp}):typeof module!="undefined"&&module.exports?module.exports=exp:global.aex=exp,exp})})()